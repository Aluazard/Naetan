### Dark World Wizard Society Decisions

targeted_decisions = {
	# Action: Recruit member
	dw_arcane_college_recruit = {
		is_in_society = yes
		filter = all
		ai_target_filter = realm
		ai_check_interval = 12
		from_potential = {
			is_adult = yes
			prisoner = no
			NOT = { trait = incapable }
			NOT = { has_character_modifier = recruitment_timer }
			society_member_of = dw_the_wizards
			society_rank = {
				society = dw_the_wizards
				rank >= 2
			}
		}
		potential = {
			is_within_diplo_range = FROM
			is_adult = yes
			prisoner = no
			NOT = { trait = incapable }
			is_in_society = no
			#AI cannot invite other AIs when society is full
			NOT = {
				is_society_rank_full = {
					society = dw_the_wizards 		
					rank = 1 								
				}
			}
			#Blocks so AI recruits sensible people (who might say no)
			OR = {
				FROM = { ai = no }
				is_friend = FROM
				is_lover = FROM
				is_close_relative = FROM
				trait = trusting
				trait = mage
				interested_in_society = dw_the_wizards
				is_learned_trigger = yes
			}
		}
		allow = {
			is_inaccessible_trigger = no
			custom_tooltip = {
				text = dw_arcane_college_recruit_block_tooltip
				OR = {
					NOT = { has_character_flag = dw_arcane_college_attempted_recruitment }
					interested_in_society = dw_the_wizards
				}
				NOT = { has_character_flag = being_recruited_by_the_arcane_college }
			}
			has_arcane_college_prerequisites = yes
			FROM = {
				is_inaccessible_trigger = no
				custom_tooltip = {
					text = recruit_delay_timer_tooltip
					NOT = { has_character_modifier = recruitment_delay_timer }
				}
			}
		}
		effect = {
			set_character_flag = dw_arcane_college_attempted_recruitment
			set_character_flag = being_recruited_by_the_arcane_college
			hidden_effect = {
				narrative_event = { id = DWSOC.1201 days = 1 } # recruitment chain
				FROM = {
					if = {
						limit = { ai = yes }
						add_character_modifier = {
							name = recruitment_timer
							days = 730
							hidden = yes
						}
					}
					add_character_modifier = {
						name = recruitment_delay_timer
						days = 120
						hidden = yes
					}
				}
			}
		}
		ai_will_do = {
			factor = 0.1
			modifier = {
				factor = 10 # recruit interested parties
				interested_in_society = dw_the_wizards
			}
			modifier = {
				factor = 0 # don't recruit characters interested in something else
				NOT = { interested_in_society = dw_the_wizards }
				is_interested_in_any_society = yes
			}
		}
	}

	dw_brew_happiness_potion = {
		filter = home_court
		ai_target_filter = home_court
		is_in_society = yes

		from_potential = {
			society_rank = {
				rank >= 2
				society = dw_the_wizards
			}
		}

		potential = {
			OR = {
				trait = stressed
				trait = depressed
			}
			OR = {
				FROM = { ai = no }
				is_close_relative = FROM
				is_friend = FROM
				is_lover = FROM
			}
		}

		allow = {
			FROM = { has_society_currency_minor_trigger = yes }
			OR = {
				trait = stressed
				trait = depressed
			}
			custom_tooltip = {
				text = must_have_ingredients_tt
				hidden_tooltip = {
					FROM = {
						any_artifact = {
							count = 2
							has_artifact_flag = ingredient
						}
					}
				}
			}
			custom_tooltip = {
				text = must_not_already_be_preparing_potion_tt
				hidden_tooltip = { FROM = { NOT = { has_character_flag = preparing_potion } } }
			}
		}

		effect = {
			FROM = { detract_society_currency_minor_effect = yes }
			FROM = { set_character_flag = preparing_potion }

			if = {
				limit = { character = FROM } #Making yourself a potion
				custom_tooltip = {
					text = brew_happiness_potion_effect_self
					set_character_flag = potion_target_is_self
					character_event = { id = DWSOC.5115 }
				}
			}

			if = {
				limit = { NOT = { character = FROM } } #Making someone else a potion
				save_event_target_as = potion_target
				custom_tooltip = {
					text = brew_happiness_potion_effect_other
					FROM = { character_event = { id = DWSOC.5115 } }
				}
			}

			tooltip = {
				if = { 
					limit = { trait = stressed }
					remove_trait = stressed
				}
				if = { 
					limit = { trait = depressed }
					remove_trait = depressed
				}
				if = {
					limit = { has_character_modifier = apathetic }
					remove_character_modifier = apathetic
				}
			}
		}

		ai_will_do = {

			factor = 0.001
			modifier = {	
				factor = 100
				character = FROM
			}
			modifier = {
				factor = 10
				reverse_opinion = {
					who = FROM
					value = 30
				}
			}
		}
	}

	dw_the_wizards_mage_trait_choice = { # Done
		only_playable = yes
		
		filter = self
		ai_target_filter = self
		
		potential = {
			character = FROM
			is_playable = yes
			is_adult = yes
			society_member_of = dw_the_wizards
			society_rank == 2
			NOT = { has_character_flag = dw_declined_becoming_mage }
		}
		
		allow = {
			custom_tooltip = {
				text = dw_mage_trait_choice_tooltip
				
				NOT = { has_character_flag = dw_making_mage_trait_choice_flag }
			}
			NOT = { trait = mage }
			has_society_currency_minor_trigger = yes
		}
		
		effect = {
			hidden_tooltip = {
				narrative_event = { id = DWSOC.1900 }
			}
			set_character_flag = dw_making_mage_trait_choice_flag
			detract_society_currency_minor_effect = yes
		}
		
		ai_will_do = {
			factor = 1
			modifier = {
				factor = 0
				lifestyle_traits = 1
			}
		}
	}

	#Power: write Magnum Opus
	dw_the_wizards_write_arcane_theory = {
		is_in_society = yes
		
		filter = self
		ai_target_filter = self

		potential = {
			society_member_of = dw_the_wizards
			society_rank = 4
			prisoner = no
			NOT = { trait = incapable }
		}

		allow = {
			FROM = {
				custom_tooltip = {
					text = dw_the_wizards_wrote_arcane_theory_cd_tooltip
					NOT = { has_character_flag = wrote_arcane_theory }
				}
				has_society_currency_major_trigger = yes
				custom_tooltip = {
					text = dw_the_wizards_wrote_arcane_theory_duplicate
					OR = {
    					NOR = {
    						has_artifact = arcane_theory_ritual_magic_1
							has_artifact = arcane_theory_ritual_magic_2
							has_artifact = arcane_theory_ritual_magic_3
							has_artifact = arcane_theory_ritual_magic_4
    					}
    					NOR = {
    						has_artifact = arcane_theory_formula_magic_1
							has_artifact = arcane_theory_formula_magic_2
							has_artifact = arcane_theory_formula_magic_3
							has_artifact = arcane_theory_formula_magic_4
    					}
    					NOR = {
    						has_artifact = arcane_theory_magic_techniques_1
							has_artifact = arcane_theory_magic_techniques_2
							has_artifact = arcane_theory_magic_techniques_3
							has_artifact = arcane_theory_magic_techniques_4
    					}
    					NOR = {
    						has_artifact = arcane_theory_magic_forms_1
							has_artifact = arcane_theory_magic_forms_2
							has_artifact = arcane_theory_magic_forms_3
							has_artifact = arcane_theory_magic_forms_4
    					}
    					NOR = {
    						has_artifact = arcane_theory_arcane_bestiary_1
							has_artifact = arcane_theory_arcane_bestiary_2
							has_artifact = arcane_theory_arcane_bestiary_3
							has_artifact = arcane_theory_arcane_bestiary_4
    					}
    					NOR = {
    						has_artifact = arcane_theory_realms_power_1
							has_artifact = arcane_theory_realms_power_2
							has_artifact = arcane_theory_realms_power_3
							has_artifact = arcane_theory_realms_power_4
    					}
    				}
    			}
			}
		}

		effect = {
			hidden_effect = { 
				narrative_event = { id = DWSOC.1610 days = 1 }
				set_character_flag = wrote_arcane_theory
			}
			detract_society_currency_major_effect = yes
		}
	}
}

society_decisions = {
	#Write a Theory Paper
	dw_the_wizards_write_arcane_theory_paper = {
		potential = {
			society_member_of = dw_the_wizards
		}

		allow = {
			prisoner = no
			custom_tooltip = {
				text = write_theory_paper_decision_cooldown_timer_tt
				hidden_trigger = {
					NOT = {
						has_character_modifier = write_theory_paper_decision_cooldown_timer
					}
				}
			}
			NOT = { is_inaccessible_trigger = yes }
			NOT = { trait = incapable }
		}

		effect = {
			custom_tooltip = {
				text = write_theory_paper_decision_effect_tt
				add_character_modifier = {
					modifier = write_theory_paper_decision_cooldown_timer
					years = 5
					hidden = yes
				}
				character_event = { id = DWSOC.1630 }
			}
		}

		ai_will_do = {
			factor = 1
			modifier = {
				factor = 0.001 # Slow down
			}
		}
	}
	
	# Build a Laboratory
	dw_the_wizards_build_laboratory = {
		only_playable = yes
		is_high_prio = yes
		
		potential = {
			society_member_of = dw_the_wizards
			has_quest = quest_dw_the_wizards_build_laboratory
			is_playable = yes
			block_general_event_trigger = no
			NOT = { has_character_flag = building_laboratory }
			NOT = { has_character_flag = built_laboratory }
		}
		allow = {
			wealth = 50
		}
		effect = {
			wealth = -50
			set_character_flag = building_laboratory
			custom_tooltip = { text = start_constructing_laboratory_tooltip }
			hidden_tooltip = { character_event = { id = DWSOC.1100 } }
		}
		ai_will_do = {
			factor = 1
			
			modifier = {
				factor = 0
				NOT = { wealth = 75 }
			}
			
			modifier = {
				factor = 0.1
				NOT = { age = 30 }
			}
		}
	}

}