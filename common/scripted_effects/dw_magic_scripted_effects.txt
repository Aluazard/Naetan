dw_gender_swap = {
    set_gender = opposite
    remove_trait = homosexual
    if = {
        limit = {
            is_female = yes
            has_dw_bodytrait_content = yes
        }
        if = {
            limit = { NOT = { trait = futa } } # A futa already has a cock, so we'd leave it alone
            add_cock_trait = yes
        }
        remove_trait = futa
        remove_trait = dw_tiny_tits
        remove_trait = dw_small_tits
        remove_trait = dw_regular_tits
        remove_trait = dw_big_tits
        remove_trait = dw_huge_tits
        remove_trait = dw_enormous_tits
        remove_trait = dw_gigantic_tits
    }
    else_if = {
        limit = {
            is_female = no
            has_dw_bodytrait_content = yes
        }
        remove_trait = trap
        remove_trait = dw_tiny_dick
        remove_trait = dw_small_dick
        remove_trait = dw_regular_dick
        remove_trait = dw_big_dick
        remove_trait = dw_huge_dick
        remove_trait = dw_enormous_dick
        remove_trait = dw_gigantic_dick
        add_tits_trait = yes
    }
}
dw_breast_growth = {
    if = {
        limit = { trait = dw_enormous_tits }
        remove_trait = dw_enormous_tits
        add_trait = dw_gigantic_tits
    }
    else_if = {
        limit = { trait = dw_huge_tits }
        remove_trait = dw_huge_tits
        add_trait = dw_enormous_tits
    }
    else_if = {
        limit = { trait = dw_big_tits }
        remove_trait = dw_big_tits
        add_trait = dw_huge_tits
    }
    else_if = {
        limit = { trait = dw_regular_tits }
        remove_trait = dw_regular_tits
        add_trait = dw_big_tits
    }
    else_if = {
        limit = { trait = dw_small_tits }
        remove_trait = dw_small_tits
        add_trait = dw_regular_tits
    }
    else_if = {
        limit = { trait = dw_tiny_tits }
        remove_trait = dw_tiny_tits
        add_trait = dw_small_tits
    }
    else_if = {
        limit = { NOT = { trait = dw_gigantic_tits } }
        add_trait = dw_tiny_tits
    }
}
dw_cock_growth = {
    if = {
        limit = { trait = dw_enormous_dick }
        remove_trait = dw_enormous_dick
        add_trait = dw_gigantic_dick
    }
    else_if = {
        limit = { trait = dw_huge_dick }
        remove_trait = dw_huge_dick
        add_trait = dw_enormous_dick
    }
    else_if = {
        limit = { trait = dw_big_dick }
        remove_trait = dw_big_dick
        add_trait = dw_huge_dick
    }
    else_if = {
        limit = { trait = dw_regular_dick }
        remove_trait = dw_regular_dick
        add_trait = dw_big_dick
    }
    else_if = {
        limit = { trait = dw_small_dick }
        remove_trait = dw_small_dick
        add_trait = dw_regular_dick
    }
    else_if = {
        limit = { trait = dw_tiny_dick }
        remove_trait = dw_tiny_dick
        add_trait = dw_small_dick
    }
    else_if = {
        limit = { NOT = { trait = dw_gigantic_dick } }
        add_trait = dw_tiny_dick
    }
}
do_minor_healing = {
    if = {
        limit = { trait = wounded }
        remove_trait = wounded
    }
    else_if = {
        limit = { trait = scarred }
        remove_trait = scarred
    }
    else_if = {
        limit = { trait = scarred_mid }
        remove_trait = scarred_mid
        add_trait = scarred
    }
    else_if = {
        limit = { trait = dysentery }
        remove_trait = dysentery
    }
    else_if = {
        limit = { trait = flu }
        remove_trait = flu
    }
    else_if = {
        limit = { trait = gout }
        remove_trait = gout
    }
    else_if = {
        limit = { trait = ill }
        remove_trait = ill
    }
    else_if = {
        limit = { trait = has_measles }
        remove_trait = has_measles
    }
    else_if = {
        limit = { trait = lovers_pox }
        remove_trait = lovers_pox
    }
    else_if = {
        limit = {
            OR = {
                trait = cough
                trait = diarrhea
                trait = fatigue
                trait = fever
                trait = headache
            }
        }
        remove_trait = cough
        remove_trait = diarrhea
        remove_trait = fatigue
        remove_trait = fever
        remove_trait = headache
    }
}
do_minor_healing_spell = {
    remove_trait = wounded
    remove_trait = scarred
    remove_trait = scarred_mid
    remove_trait = dysentery
    remove_trait = flu
    remove_trait = gout
    remove_trait = ill
    remove_trait = has_measles
    remove_trait = lovers_pox
    remove_trait = cough
    remove_trait = diarrhea
    remove_trait = fatigue
    remove_trait = fever
    remove_trait = headache
}
do_major_healing = {
    do_minor_healing = yes # Major covers everything that minor does as well
    if = {
        limit = { trait = severely_injured }
        remove_trait = severely_injured
    }
    else_if = {
        limit = { trait = disfigured }
        remove_trait = disfigured
        add_trait = scarred
    }
    else_if = {
        limit = { trait = scarred_high }
        remove_trait = scarred_high
    }
    else_if = {
        limit = { trait = maimed }
        remove_trait = maimed
        add_trait = scarred_mid
    }
    else_if = {
        limit = { trait = has_aztec_disease }
        remove_trait = has_aztec_disease
    }
    else_if = {
        limit = { trait = has_typhus }
        remove_trait = has_typhus
    }
    else_if = {
        limit = { trait = cancer }
        remove_trait = cancer
    }
    else_if = {
        limit = { trait = has_tuberculosis }
        remove_trait = has_tuberculosis
    }
    else_if = {
        limit = { trait = dancing_plague }
        remove_trait = dancing_plague
    }
    else_if = {
        limit = { trait = food_poisoning }
        remove_trait = food_poisoning
    }
    else_if = {
        limit = { trait = syphilitic }
        remove_trait = syphilitic
    }
    else_if = {
        limit = { trait = has_typhoid_fever }
        remove_trait = has_typhoid_fever
    }
    else_if = {
        limit = { trait = leper }
        remove_trait = leper
        add_trait = scarred_mid
    }
    else_if = {
        limit = { trait = pneumonic }
        remove_trait = pneumonic
    }
    else_if = {
        limit = { trait = rabies }
        remove_trait = rabies
    }
    else_if = {
        limit = { trait = has_small_pox }
        remove_trait = has_small_pox
    }
    else_if = {
        limit = { trait = has_bubonic_plague }
        remove_trait = has_bubonic_plague
        add_trait = scarred_mid
    }
    else_if = {
        limit = { trait = infection }
        remove_trait = infection
    }
    else_if = {
        limit = { trait = mangled }
        remove_trait = mangled
        add_trait = scarred_mid
    }
    else_if = {
        limit = { trait = one_eyed }
        remove_trait = one_eyed
        add_trait = scarred_mid
    }
    else_if = {
        limit = { trait = one_handed }
        remove_trait = one_handed
        add_trait = scarred_mid
    }
    else_if = {
        limit = { trait = one_legged }
        remove_trait = one_legged
        add_trait = scarred_mid
    }
    else_if = {
        limit = { trait = blinded }
        remove_trait = blinded
        add_trait = one_eyed
    }
    else_if = {
        limit = { trait = eunuch }
        remove_trait = eunuch
        add_trait = scarred_mid
    }
    else_if = {
        limit = {
            OR = {
                trait = abdominal_pain
                trait = chest_pain
                trait = cramps
                trait = malaise
                trait = rash
                trait = vomiting
            }
        }
        remove_trait = abdominal_pain
        remove_trait = chest_pain
        remove_trait = cramps
        remove_trait = malaise
        remove_trait = rash
        remove_trait = vomiting
    }
}
do_major_healing_spell = {
    do_minor_healing_spell = yes
    remove_trait = severely_injured
    remove_trait = disfigured
    remove_trait = scarred_high
    remove_trait = maimed
    remove_trait = has_aztec_disease
    remove_trait = has_typhus
    remove_trait = cancer
    remove_trait = has_tuberculosis
    remove_trait = dancing_plague
    remove_trait = food_poisoning
    remove_trait = syphilitic
    remove_trait = has_typhoid_fever
    remove_trait = leper
    remove_trait = pneumonic
    remove_trait = rabies
    remove_trait = has_small_pox
    remove_trait = has_bubonic_plague
    remove_trait = infection
    remove_trait = mangled
    remove_trait = one_eyed
    remove_trait = one_handed
    remove_trait = one_legged
    remove_trait = blinded
    remove_trait = eunuch
    remove_trait = abdominal_pain
    remove_trait = chest_pain
    remove_trait = cramps
    remove_trait = malaise
    remove_trait = rash
    remove_trait = vomiting
}
improve_looks = {
    if = {
		limit = { trait = hunchback }
		remove_trait = hunchback
	}
	else_if = {
		limit = { trait = ugly }
		remove_trait = ugly
	}
	else_if = {
		limit = { trait = harelip }
		remove_trait = harelip
	}
	else_if = {
		limit = { trait = clubfooted }
		remove_trait = clubfooted
	}
	else_if = {
		limit = { trait = uncouth }
		remove_trait = uncouth
	}
    else_if = {
		limit = { NOT = { trait = fair }}
		add_trait = fair
	}
	else_if = {
		limit = {
            has_dw_bodytrait_content = yes
            trait = fair
            NOT = { trait = enchanting }
			OR = {
				is_female = yes
				AND = {
					is_female = no
					trait = trap
				}
			}
		}
		add_trait = enchanting
	}
    else_if = {
        limit = { NOT = { trait = groomed } }
        add_trait = groomed
    }
    else = {
        add_character_modifier = { modifier = dw_aphrodite_allure months = 12 }
    }
}
experience_oblivion = {
    random_list = {
        50 = {
            change_diplomacy = 1
            change_intrigue = 1
            change_martial = 1
            change_stewardship = 1
            change_learning = 1
        }
        25 = {
            change_diplomacy = 2
            change_intrigue = 2
            change_martial = 2
            change_stewardship = 2
            change_learning = 2
        }
        50 = {
            add_trait = depressed
        }
        25 = {
            add_trait = lunatic
        }
    }
}
apply_giant_growth = {
    if = {
        limit = { trait = dwarf }
        remove_trait = dwarf
    }
    else_if = {
        limit = { NOT = { trait = giant }}
        add_trait = giant
    }
}
consume_elder_blood = {
    if = {
        limit = { trait = vampire }
        random_list = {
            80 = { health = 0.2 }
            20 = { add_trait = immortal }
        }
    }
    else = {
        add_trait = vampire
    }
}
apply_heritage_awakening = {
    if = {
        limit = {
            culture_group = north_germanic
        }
        random_list = {
            25 = {
                trigger = { has_fae_content = yes }
                add_trait = elf_blood
            }
            25 = { add_trait = giant }
            25 = { add_trait = dwarf }
            25 = {
                trigger = { has_classic_monsters_content = yes }
                add_trait = therianthrope
                add_trait = wolf_kin
            }
        }
    }
    else_if = {
        limit = { culture_group = central_germanic }
        random_list = {
            25 = {
                trigger = { has_fae_content = yes }
                add_trait = elf_blood
            }
            25 = {
                trigger = { has_fae_content = yes }
                add_trait = orc_blood
            }
            25 = { add_trait = dwarf }
            25 = {
                trigger = { has_fae_content = yes }
                add_trait = fae_kin
            }
        }
    }
    else_if = {
        limit = { culture_group = west_germanic }
        random_list = {
            25 = {
                trigger = { has_fae_content = yes }
                add_trait = elf_blood
            }
            25 = {
                trigger = { has_fae_content = yes }
                add_trait = fae_kin
            }
        }
    }
    else_if = {
        limit = { culture_group = latin }
        random_list = {
            25 = {
                trigger = { has_fae_content = yes }
                add_trait = nymph_kin
            }
            25 = {
                trigger = { has_heaven_hell_content = yes }
                add_trait = angel_kin
            }
            25 = {
                trigger = { has_classic_monsters_content = yes }
                add_trait = therianthrope
                add_trait = horse_kin
            }
        }
    }
    else_if = {
        limit = { culture_group = iberian }
        random_list = {
            25 = {
                trigger = { has_heaven_hell_content = yes }
                add_trait = angel_kin
            }
            25 = {
                trigger = { has_fae_content = yes }
                add_trait = dragon_kin
            }
            25 = { add_trait = giant }
            25 = { add_trait = dwarf }
        }
    }
    else_if = {
        limit = { culture_group = byzantine }
        random_list = {
            25 = {
                trigger = { has_fae_content = yes }
                add_trait = nymph_kin
            }
            25 = {
                trigger = { has_heaven_hell_content = yes }
                add_trait = angel_kin
            }
            25 = {
                trigger = { has_classic_monsters_content = yes }
                add_trait = therianthrope
                add_trait = horse_kin
            }
        }
    }
    else_if = {
        limit = { culture_group = celtic }
        random_list = {
            25 = {
                trigger = { has_classic_monsters_content = yes }
                add_trait = therianthrope
                add_trait = horse_kin
            }
            25 = {
                trigger = { has_classic_monsters_content = yes }
                add_trait = therianthrope
                add_trait = dog_kin
            }
            25 = { add_trait = giant }
            25 = {
                trigger = { has_fae_content = yes }
                add_trait = nymph_kin
            }
        }
    }
    else_if = {
        limit = { culture_group = finno_ugric }
        random_list = {
            25 = {
                trigger = { has_fae_content = yes }
                add_trait = fae_kin
            }
            25 = {
                trigger = { has_classic_monsters_content = yes }
                add_trait = therianthrope
                add_trait = wolf_kin
            }
        }
    }
    else_if = {
        limit = { culture_group = baltic }
        random_list = {
            25 = {
                trigger = { has_fae_content = yes }
                add_trait = fae_kin
            }
            25 = {
                trigger = { has_classic_monsters_content = yes }
                add_trait = therianthrope
                add_trait = horse_kin
            }
            25 = {
                trigger = { has_classic_monsters_content = yes }
                add_trait = therianthrope
                add_trait = dog_kin
            }
            # Goat kin
            # Bear kin
        }
    }
    else_if = {
        limit = { culture_group = altaic }
        random_list = {
            25 = {
                trigger = { has_classic_monsters_content = yes }
                add_trait = therianthrope
                add_trait = wolf_kin
            }
            25 = {
                trigger = { has_classic_monsters_content = yes }
                add_trait = therianthrope
                add_trait = horse_kin
            }
            # Falcon kin
            # Deer kin
        }
    }
    else_if = {
        limit = { culture_group = arabic }
        random_list = {
            25 = {
                trigger = { has_classic_monsters_content = yes }
                add_trait = therianthrope
                add_trait = cat_kin
            }
            25 = {
                trigger = { has_classic_monsters_content = yes }
                add_trait = therianthrope
                add_trait = hyena_kin
            }
            25 = {
                trigger = { has_classic_monsters_content = yes }
                add_trait = therianthrope
                add_trait = wolf_kin
            }
            25 = {
                trigger = { has_heaven_hell_content = yes }
                add_trait = angel_kin
            }
            25 = {
                trigger = { has_heaven_hell_content = yes }
                add_trait = demon_kin
            }
            # Bull kin
            # Fish kin
            # Bird kin
        }
    }
    else_if = {
        limit = { culture_group = east_slavic }
        random_list = {
            25 = {
                trigger = { has_fae_content = yes }
                add_trait = fae_kin
            }
            25 = {
                trigger = { has_fae_content = yes }
                add_trait = nymph_kin
            }
            25 = { add_trait = dwarf }
            25 = {
                trigger = { has_heaven_hell_content = yes }
                add_trait = demon_kin
            }
            25 = {
                trigger = { has_classic_monsters_content = yes }
                add_trait = therianthrope
                add_trait = fox_kin
            }
            25 = { add_trait = giant }
            25 = {
                trigger = { has_heaven_hell_content = yes }
                add_trait = angel_kin
            }
            # Goat kin
            # Frog kin
        }
    }
    else_if = {
        limit = { culture_group = west_slavic }
        random_list = {
            25 = {
                trigger = { has_classic_monsters_content = yes }
                add_trait = therianthrope
                add_trait = wolf_kin
            }
            25 = {
                trigger = { has_fae_content = yes }
                add_trait = fae_kin
            }
            25 = {
                trigger = { has_fae_content = yes }
                add_trait = nymph_kin
            }
        }
    }
    else_if = {
        limit = { culture_group = south_slavic }
        random_list = {
            25 = {
                trigger = { has_fae_content = yes }
                add_trait = fae_kin
            }
            25 = {
                trigger = { has_fae_content = yes }
                add_trait = nymph_kin
            }
            # Frog kin
        }
    }
    else_if = {
        limit = { culture_group = magyar }
        random_list = {
            25 = {
                trigger = { has_fae_content = yes }
                add_trait = nymph_kin
            }
            25 = {
                trigger = { has_heaven_hell_content = yes }
                add_trait = demon_kin
            }
            25 = {
                trigger = { has_fae_content = yes }
                add_trait = dragon_kin
            }
            # Deer kin
            # Falcon kin
            # Griffin
        }
    }
    else_if = {
        limit = { culture_group = iranian }
        random_list = {
            25 = {
                trigger = { has_heaven_hell_content = yes }
                add_trait = angel_kin
            }
            25 = {
                trigger = { has_fae_content = yes }
                add_trait = nymph_kin
            }
            25 = {
                trigger = { has_seeds_chaos_content = yes }
                add_trait = tentacle
            }
            # Undead
            # Serpent kin
            # Goat kin
        }
    }
    else_if = {
        limit = { culture_group = east_african }
        random_list = {
            25 = {
                trigger = { has_fae_content = yes }
                add_trait = nymph_kin
            }
            25 = {
                trigger = { has_classic_monsters_content = yes }
                add_trait = therianthrope
                add_trait = hyena_kin
            }
            # Hippo kin
            # Monkey kin
            # Tiger kin
        }
    }
    else_if = {
        limit = { culture_group = central_african }
        random_list = {
            25 = {
                trigger = { has_fae_content = yes }
                add_trait = nymph_kin
            }
            25 = { add_trait = dwarf }
            25 = {
                trigger = { has_fae_content = yes }
                add_trait = dragon_kin
            }
            # Undead
            # Tigern kin
            # Serpent kin
        }
    }
    else_if = {
        limit = { culture_group = west_african }
        random_list = {
            25 = {
                trigger = { has_fae_content = yes }
                add_trait = nymph_kin
            }
            25 = {
                trigger = { has_heaven_hell_content = yes }
                add_trait = demon_kin
            }
            # Serpent kin
            # Spider kin *shudder*
        }
    }
    else_if = {
        limit = { culture_group = mesoamerican }
        random_list = {
            25 = {
                trigger = { has_fae_content = yes }
                add_trait = nymph_kin
            }
            # Rabbit kin
            # Serpent kin
            # Falcon kin
        }
    }
    else_if = {
        limit = { culture_group = israelite }
        random_list = {
            25 = {
                trigger = { has_heaven_hell_content = yes }
                add_trait = angel_kin
            }
            25 = {
                trigger = { has_heaven_hell_content = yes }
                add_trait = demon_kin
            }
        }
    }
    else_if = {
        limit = { culture_group = indo_aryan_group }
        random_list = {
            25 = {
                trigger = { has_fae_content = yes }
                add_trait = dragon_kin
            }
            25 = {
                trigger = { has_fae_content = yes }
                add_trait = nymph_kin
            }
            # Serpent kin
        }
    }
    else_if = {
        limit = { culture_group = dravidian_group }
        random_list = {
            25 = {
                trigger = { has_classic_monsters_content = yes }
                add_trait = therianthrope
                add_trait = fox_kin
            }
            # Elephant kin
            # Monkey kin
        }
    }
    else_if = {
        limit = { culture_group = tibetan_group }
        random_list = {
            25 = {
                trigger = { has_classic_monsters_content = yes }
                add_trait = therianthrope
                add_trait = fox_kin
            }
            25 = {
                trigger = { has_heaven_hell_content = yes }
                add_trait = demon_kin
            }
            # Monkey kin
            # Rabbit kin
            # Undead
        }
    }
    else_if = {
        limit = { culture_group = chinese_group }
        random_list = {
            25 = {
                trigger = { has_fae_content = yes }
                add_trait = dragon_kin
            }
            25 = {
                trigger = { has_classic_monsters_content = yes }
                add_trait = therianthrope
                add_trait = fox_kin
            }
            25 = {
                trigger = { has_classic_monsters_content = yes }
                add_trait = therianthrope
                add_trait = cat_kin
            }
            # Crow kin
        }
    }
    else = {
        random_list = {
            25 = {
                trigger = { has_heaven_hell_content = yes }
                add_trait = demon_kin
            }
            25 = {
                trigger = { has_fae_content = yes }
                add_trait = fae_kin
            }
            25 = { add_trait = dwarf }
            25 = { add_trait = giant }
        }
    }
}
# Commune Spell results
dw_determine_commune_results = {
    random_list = {
        20 = { add_character_modifier = { modifier = dw_commune_justice months = 6 } }
        20 = { add_character_modifier = { modifier = dw_commune_guardian months = 6 } }
        20 = { add_character_modifier = { modifier = dw_commune_purge months = 6 } }
        20 = { add_character_modifier = { modifier = dw_commune_prosperity months = 6 } }
        20 = { add_character_modifier = { modifier = dw_commune_stability months = 6 } }
        20 = { add_character_modifier = { modifier = dw_commune_conflict months = 6 } }
    }
}
# Any spell related cooldowns should go into here where they can be cleared when taking a mana potion
clear_mana_cooldowns = {
    remove_character_modifier = dw_summon_familiar_cooldown
    remove_character_modifier = dw_disintegrate_cooldown
    remove_character_modifier = dw_lightning_bolt_cooldown
    remove_character_modifier = dw_midas_touch_cooldown
    remove_character_modifier = dw_quick_heal_cooldown
    remove_character_modifier = dw_summon_imp_familiar_cooldown
    remove_character_modifier = dw_commune_cooldown
    remove_character_modifier = dw_minor_heal_cooldown
    remove_character_modifier = dw_major_heal_cooldown
    remove_character_modifier = dw_raise_undead_cooldown
}
