### Dark World Chosen of Lilith Events
### POWERS ###
## 7822 - 7824 Invite member to court

namespace = DWSOC

### Recruitment ###

# Do you approve of "alternative views"? - Recruit
narrative_event = {
	id = DWSOC.7001
	desc = DWSOC7001
	picture = lilith_society_approach2
	is_triggered_only = yes # targetted_decision
	title = dw_recruitment_drive
	prisoner = no # pre-trigger
	immediate = {
		if = {
			limit = { NOT = { event_target:dw_chosen_recruiter = { always = yes } } }
			FROMFROM = { save_event_target_as = dw_chosen_recruiter }
		}
		save_event_target_as = dw_chosen_recruit
	}
	fail_trigger_effect = {
		clr_character_flag = being_recruited_by_the_chosen
		clr_character_flag = dw_chosen_attempted_recruitment
	}
	#Approving of heretics
	option = {
		name = DWSOC7001A
		reverse_opinion = {
			who = event_target:dw_chosen_recruiter
			modifier = opinion_agreed_with_opinion
			years = 5
		}
		set_character_flag = approves_of_satanism
		hidden_effect = { 
			narrative_event = { id = DWSOC.7002 days = 3 } 
		}
		ai_chance = {
			factor = 75
			modifier = {
				factor = 1.5
				trait = trusting
			}
			modifier = {
				factor = 1.5
				OR = {
					trait = bad_priest_christian
					trait = bad_priest_muslim
					trait = bad_priest_norse
					trait = bad_priest_tengri
					trait = bad_priest_zoroastrian
					trait = bad_priest_aztec
				}
			}
			modifier = {
				factor = 1.5
				trait = hedonist
			}
			modifier = {
				factor = 1.5
				trait = lustful
			}
			modifier = {
				factor = 1.5
				trait = cynical
			}
		}
	}
	#Disapproving of heretics
	option = {
		name = DWSOC7001B
		reverse_opinion = {
			who = event_target:dw_chosen_recruiter
			modifier = opinion_disagreed_with_opinion
			years = 5
		}
		set_character_flag = disapproves_of_satanism
		clr_character_flag = being_recruited_by_the_chosen
		hidden_effect = { 
			event_target:dw_chosen_recruiter = {
				increase_visibility_effect = yes # Visibility increased by 5 for the failed probing attempt
				narrative_event = { id = DWSOC.7003 days = 15 } 
			} 
		}
		ai_chance = {
			factor = 25
			modifier = {
				factor = 5
				has_pious_trait_trigger = yes
			}
			modifier = {
				factor = 2
				has_crusade_trait_trigger = yes
			}
		}
	}
}
## We've an interested party - Recruiter
narrative_event = {
	id = DWSOC.7002
	desc = DWSOC7002
	picture = lilith_society_approach2
	is_triggered_only = yes # .7001
	title = dw_recruitment_drive
	option = { # Let's invite them
		name = DWSOC7002A
		hidden_effect = {
			event_target:dw_chosen_recruit = { narrative_event = { id = DWSOC.7008 days = 5 } }
		}
	}
}
## We've been rejected - Recruiter
narrative_event = {
	id = DWSOC.7003
	desc = DWSOC7003
	picture = lilith_society_approach2
	is_triggered_only = yes # .7001
	title = dw_recruitment_drive
	option = { # Disappointing
		name = DWSOC7003A
	}
}
## I'm a member of the society - Recruit
narrative_event = {
	id = DWSOC.7008
	desc = DWSOC7008
	picture = lilith_society_approach2
	is_triggered_only = yes # .7003 or .7002
	title = dw_recruitment_drive
	option = { # Joins
		name = DWSOC7008A
		join_society = dw_the_chosen_of_lilith
		hidden_effect = {
			clr_character_flag = being_recruited_by_the_chosen
			clr_character_flag = dw_chosen_attempted_recruitment
			event_target:dw_chosen_recruiter = { narrative_event = { id = DWSOC.7009 days = 3 } }
		}
	}
}
## We've a new member of the society - Recruiter
narrative_event = {
	id = DWSOC.7009
	desc = DWSOC7009
	picture = lilith_society_approach2
	is_triggered_only = yes # .7003 or .7002
	title = dw_recruitment_drive
	option = { # I've strengthened our society
		name = DWSOC7009A
		add_society_currency_medium_effect = yes
	}
}
### POWERS ###
## 7822 - 7824 Invite member to court
#Power: invite Chosen of Lilith to court
character_event = {
	id = DWSOC.7822
	hide_window = yes
	is_triggered_only = yes
	immediate = {
		clr_character_flag = disciple_arriving
		random_list = {
			#Witch
			30 = {
				random_list = {
					33 = {
						create_character = {
							random_traits = yes
							dynasty = none
							religion = ROOT
							female = yes
							age = 19
							health = 7
						}
						new_character = { save_event_target_as = devil_disciple }
					}
					33 = {
						create_character = {
							random_traits = yes
							dynasty = none
							religion = ROOT
							female = yes
							age = 37
							health = 7
						}
						new_character = { save_event_target_as = devil_disciple }
					}
					33 = {
						create_character = {
							random_traits = yes
							dynasty = none
							religion = ROOT
							female = yes
							age = 68
							health = 7
						}
						new_character = { save_event_target_as = devil_disciple }
					}
				}
			}
			#Succubus
			30 = {
				random_list = {
					50 = {
						create_character = {
							random_traits = yes
							dynasty = none
							religion = ROOT
							female = yes
							age = 18
							health = 7
						}
						new_character = { 
							save_event_target_as = devil_disciple 
							add_trait = lilith
						}
					}
					50 = {
						create_character = {
							random_traits = yes
							dynasty = none
							religion = ROOT
							female = yes
							age = 28
							health = 7
						}
						new_character = { 
							save_event_target_as = devil_disciple 
							add_trait = lilith
						}
					}
				}
			}
			#Warlock
			20 = {
				random_list = {
					33 = {
						create_character = {
							random_traits = yes
							dynasty = none
							religion = ROOT
							female = no
							age = 22
							health = 7
						}
						new_character = { save_event_target_as = devil_disciple }
					}
					33 = {
						create_character = {
							random_traits = yes
							dynasty = none
							religion = ROOT
							female = no
							age = 42
							health = 7
						}
						new_character = { save_event_target_as = devil_disciple }
					}
					33 = {
						create_character = {
							random_traits = yes
							dynasty = none
							religion = ROOT
							female = no
							age = 65
							health = 7
						}
						new_character = { save_event_target_as = devil_disciple }
					}
				}
			}
			#Incubus
			20 = {
				random_list = {
					50 = {
						create_character = {
							random_traits = yes
							dynasty = none
							religion = ROOT
							female = no
							age = 20
							health = 7
						}
						new_character = { 
							save_event_target_as = devil_disciple 
							add_trait = incubus
						}
					}
					50 = {
						create_character = {
							random_traits = yes
							dynasty = none
							religion = ROOT
							female = no
							age = 30
							health = 7
						}
						new_character = { 
							save_event_target_as = devil_disciple 
							add_trait = incubus
						}
					}
				}
			}
		}
		event_target:devil_disciple = {
			#Join PREV's (ROOT's) society
			if = {
				limit = {
					ROOT = { ai = no }
				}
				join_society = dw_the_chosen_of_lilith
			}
			#Set correct education
			remove_education_effect = yes
			random_list = {
				15 = { add_trait = flamboyant_schemer }
				15 = { add_trait = intricate_webweaver }
				10 = { add_trait = elusive_shadow }
				5 = { add_trait = grey_eminence }
				5 = { add_trait = brilliant_strategist }
				5 = { add_trait = midas_touched }
			}
			#Up intrigue
			random_list = {
				33 = { change_intrigue = 2 }
				33 = { change_intrigue = 3 }
				33 = { change_intrigue = 4 }
			}
			#Set some interesting traits 

			#Possessed/lunatic
			random = {
				chance = 10
				add_trait = possessed
			}
			random = {
				chance = 5
				add_trait = lunatic
			}
			#Nice congenital
			random_list = {
				10 = {
					add_trait = fair
					remove_trait = ugly
					modifier = {
						factor = 5 # An Incubus or Succubus has a strong natural tendency towards being fair
						OR = {
							trait = lilith
							trait = incubus
						}
					}
				}
				5 = {
					add_trait = genius
					remove_trait = imbecile
					remove_trait = quick
					remove_trait = slow
				}
				10 = {
					add_trait = quick
					remove_trait = imbecile
					remove_trait = genius
					remove_trait = slow
				}
				5 = {
					add_trait = strong
					remove_trait = weak
				}
				20 = { }
			}
			#Bad congenital
			random_list = {
				10 = {
					add_trait = ugly
					remove_trait = fair
					modifier = {
						factor = 0 # No ugly Succubus or Incubus's
						OR = {
							trait = lilith
							trait = incubus
						}
					}
				}
				10 = {
					add_trait = hunchback
					modifier = {
						factor = 0 # No hunchbacked Succubus or Incubus's
						OR = {
							trait = lilith
							trait = incubus
						}
					}
				}
				10 = {
					add_trait = clubfooted
					modifier = {
						factor = 0 # No clubfooted Succubus or Incubus's
						OR = {
							trait = lilith
							trait = incubus
						}
					}
				}
				50 = { }
			}
			#Lifestyle
			remove_lifestyle_trait_effect = yes
			random_list = {
				25 = { add_trait = hedonist }
				10 = { add_trait = mystic }
				15 = { add_trait = schemer }
				25 = { 
					if = { limit = { is_female = yes } add_trait = seductress }
					if = { limit = { is_female = no } add_trait = seducer }
				}
				5 = { add_trait = impaler }
				20 = { }
			}

			#Vices
			remove_trait = chaste
			remove_trait = humble
			random = {
				chance = 30
				add_trait = lustful
			}
			random = {
				chance = 25
				add_trait = proud
			}
			random = {
				chance = 15
				add_trait = greedy
				remove_trait = charitable
			}
			random = {
				chance = 10
				add_trait = gluttonous
				remove_trait = temperate
			}
			random = {
				chance = 5
				add_trait = envious
				remove_trait = kind
			}

			#Misc traits
			remove_trait = honest
			remove_trait = zealous
			remove_trait = trusting
			random = {
				chance = 15
				add_trait = deceitful
			}
			random = {
				chance = 25
				add_trait = ambitious
				remove_trait = content
			}
			random = {
				chance = 10
				add_trait = paranoid
			}
			random = {
				chance = 15
				add_trait = cruel
				remove_trait = kind
			}
			random = {
				chance = 10
				add_trait = homosexual
			}
			if = {
				limit = { has_dlc = "Reapers" }
				random = {
					chance = 15
					add_trait = physician
				}
			}
			
			# Females should be able to lead armies
			set_character_flag = special_marshal

			#Nicknames
			random_list = {
				10 = {
					give_nickname = nick_the_alchemist
				}
				10 = { 
					modifier = {
						factor = 0
						NOR = {
							trait = deceitful
							trait = elusive_shadow
							trait = intricate_webweaver
						}
					}
					give_nickname = nick_the_spider
				}
				10 = { 
					modifier = {
						factor = 0
						has_education_intrigue_trigger = no
					}
					give_nickname = nick_the_whisperer
				}
				10 = { 
					modifier = {
						factor = 0
						has_education_intrigue_trigger = no
					}
					give_nickname = nick_the_shadow
				}
				10 = { 
					give_nickname = nick_of_the_wilds
				}
				20 = { 
					modifier = {
						factor = 0
						NAND = {
							is_female = yes
							OR = {
								trait = seductress
								trait = lustful
							}
						}
					}
					give_nickname = nick_the_temptress
				}
				20 = { 
					modifier = {
						factor = 0
						NAND = {
							is_female = no
							OR = {
								trait = seducer
								trait = lustful
							}
						}
					}
					give_nickname = nick_the_seducer
				}
				25 = { 
					modifier = {
						factor = 0
						NAND = {
							is_female = yes
							trait = fair
						}
					}
					give_nickname = nick_the_fair
				}
				25 = { 
					modifier = {
						factor = 0
						NAND = {
							is_female = no
							trait = fair
						}
					}
					give_nickname = nick_the_handsome
				}
				10 = { 
					give_nickname = nick_the_black
				}
				10 = { 
					modifier = {
						factor = 0
						NOT = { trait = hunchback }
					}
					give_nickname = nick_the_hunchback
				}
				50 = { }
			}
			character_event = { id = DWSOC.7823 }	
		}
	}
}

#Ping event for new court member
character_event = {
	id = DWSOC.7823
	hide_window = yes
	is_triggered_only = yes
	immediate = {
		FROM = { narrative_event = { id = DWSOC.7824 } }
	}
}

#Introduction of new court member
narrative_event = {
	id = DWSOC.7824
	picture = a_placeholder
	title = dw_chosen_of_lilith_to_court_title
	desc = {
		trigger = {
			is_female = yes # Female ruler
		}
		text = DWSOC7824
		picture = court_queen_throne1
	}
	desc = {
		trigger = {
			NOT = { is_female = yes } # Male ruler
		}
		text = DWSOC7824
		picture = court_king_throne1
	}
	is_triggered_only = yes
	option = {
		name = DWSOC7824A
		reverse_opinion = {
			who = FROM
			modifier = opinion_loyal_servant
		}
	}
}


###MISSIONS###
## 7024 - 7025 - Sacrifice Someone
## 7026 - 7027 - Demonic Impregnation
## 7200 - Mission Tombola
## 7250 -  - Build a Temple

##DW Mission Tombola
character_event = {
	id = DWSOC.7200
	hide_window = yes
	is_triggered_only = yes
	is_in_society = yes

	trigger = {
		society_member_of = dw_the_chosen_of_lilith
		has_any_quest = no
		NOT = { has_character_modifier = quest_cooldown_timer }
		NOT = { is_society_grandmaster = yes }
		NOT = { is_inaccessible_trigger = yes }
	}

	immediate = {
		random_society_member = {
			limit = {
				is_society_grandmaster = yes
				same_society_as = ROOT
			}
			save_event_target_as = grand_enchanter
		}

		random_list = { 
			20 = {
				trigger = { 
					is_playable = yes
				}
				event_target:grand_enchanter = {
					character_event = { id = DWSOC.7024 } #sacrifice someone
				}
			}
			20 = { 
				trigger = {
					society_rank >= 3
					is_playable = yes
					NOT = { has_character_flag = given_unholy_impregnation_mission }
				}
				set_character_flag = given_unholy_impregnation_mission
				event_target:grand_enchanter = {
					character_event = { id = DWSOC.7026 } #demonic impregnation
				}
			}
			20 = {
				trigger = {
					society_rank >= 2
					is_playable = yes
					wealth = 25
					NOT = { has_character_flag = dw_build_chapel_lilith }
				}
				society_quest_event = { id = DWSOC.7250 } # Build a temple to Lilith
			}
			75 = { # AI bypasses missions at times
				trigger = {
					ai = yes
				}
				random_list = {
					70 = {
						modifier = {
							factor = 0.9
							society_influence >= 30
						}
						modifier = {
							factor = 0.9
							society_influence >= 40
						}
						modifier = {
							factor = 0.8
							society_influence >= 50
						}
						modifier = {
							factor = 0.7
							society_influence >= 70
						}
						modifier = {
							factor = 0.6
							society_influence >= 80
						}
						modifier = {
							factor = 0.5
							society_influence >= 90
						}
						add_mission_succeed_influence_effect = yes
					}
					30 = {
						add_mission_fail_influence_effect = yes
					}
				}
			}

			200 = {
				trigger = {
					ai = yes
				}
				#Do nothing for AI
			}
		}
	}
}

##MISSION: Build a Temple to Lilith

## Member gets a letter to build a Temple to Lilith
society_quest_event = {
	id = DWSOC.7250
	desc = DWSOC7250
	portrait = event_target:grand_enchanter
	border = GFX_event_letter_frame_intrigue
	is_triggered_only = yes # from 7250
	option = {
		name = DWSOCACCEPT
		set_quest = quest_the_chosen_of_lilith_build_temple
		hidden_effect = {
			narrative_event = { id = DWSOC.7255 days = 1 }
			set_character_flag = dw_build_chapel_lilith
		}
	}
	option = {
		name = DWSOCDECLINE
		add_character_modifier = {
			name = quest_cooldown_timer
			hidden = yes
			days = 1000
		}
	}	
}

## Where to construct the temple
narrative_event = {
	id = DWSOC.7255
	title = dw_chosen_quest_title
	picture = lilith_society_lilith_temple1
	is_triggered_only = yes # by .7250
	desc = {
		text = DWSOC7255.0
		trigger = {
			OR = {
				is_feudal = yes
				is_merchant_republic = yes
				is_tribal   = yes
			}
		}
	}
	desc = {
		text = DWSOC7255.1
		trigger = {
			is_nomadic = yes
		}
	}
	immediate = {
		# This is a variable where we'll track the effort in order to measure the reward of favor from Lilith and the society
		set_variable = { which = "dw_lilith_temple_value" value = 0 }
	}
	option = { # Construct Secret Room
		trigger = {
			wealth = 50
			NOT = { is_nomadic = yes }
		}
		name = DWSOC7255A
		wealth = -50
		# days ~60
		change_variable = { which = "dw_lilith_temple_value" value = 5 }
		hidden_effect = {
			narrative_event = { id = DWSOC.7260 days = 55 random = 10 }
		}
	}
	option = { # Nature shrine
		name = DWSOC7255B
		# days ~30
		change_variable = { which = "dw_lilith_temple_value" value = 1 }
		hidden_effect = {
			set_character_flag = dw_nature_temple
			narrative_event = { id = DWSOC.7262 days = 25 random = 10 }
		}
	}
	option = { # Portable Shrine
		trigger = {
			is_nomadic = yes
		}
		name = DWSOC7255C
		# days ~60
		wealth = -5
		change_variable = { which = "dw_lilith_temple_value" value = 3 }
		hidden_effect = {
			narrative_event = { id = DWSOC.7264 days = 55 random = 10 }
		}
	}
	option = { # Private Chambers
		trigger = {
			NOT = { is_nomadic = yes }
		}
		name = DWSOC7255D
		# days ~30
		change_variable = { which = "dw_lilith_temple_value" value = 1 }
		hidden_effect = {
			narrative_event = { id = DWSOC.7266 days = 25 random = 10 }
		}
	}
}

# Secret Room
narrative_event = {
	id = DWSOC.7260
	title = dw_chosen_quest_title
	picture = lilith_society_lilith_temple1
	is_triggered_only = yes # by .7255
	desc = DWSOC7260
	option = { # high quality
		trigger = {
			wealth = 50
		}
		name = DWSOC7260A
		wealth = -50
		change_variable = { which = "dw_lilith_temple_value" value = 5 }
		# ~ 75 days
		hidden_effect = {
			narrative_event = { id = DWSOC.7270 days = 70 random = 10 }
		}
	}
	option = { # medium quality
		trigger = {
			wealth = 25
		}
		name = DWSOC7260B
		wealth = -25
		change_variable = { which = "dw_lilith_temple_value" value = 3 }
		# ~ 60 days
		hidden_effect = {
			narrative_event = { id = DWSOC.7270 days = 55 random = 10 }
		}
	}
	option = { # low quality
		trigger = {
			wealth = 10
		}
		name = DWSOC7260C
		wealth = -10
		change_variable = { which = "dw_lilith_temple_value" value = 1 }
		# ~ 45 days
		hidden_effect = {
			narrative_event = { id = DWSOC.7270 days = 40 random = 10 }
		}
	}
	option = { # Whatever is on hand
		name = DWSOC7260D
		# ~ 30 days
		hidden_effect = {
			narrative_event = { id = DWSOC.7270 days = 25 random = 10 }
		}
	}
}

# Nature shrine
narrative_event = {
	id = DWSOC.7262
	title = dw_chosen_quest_title
	picture = lilith_society_lilith_temple1
	is_triggered_only = yes # by .7255
	desc = DWSOC7262
	option = { # high quality
		trigger = {
			wealth = 50
		}
		name = DWSOC7260A # Reusing quality localization
		wealth = -50
		change_variable = { which = "dw_lilith_temple_value" value = 6 }
		# ~ 60 days
		hidden_effect = {
			narrative_event = { id = DWSOC.7270 days = 70 random = 10 }
		}
	}
	option = { # medium quality
		trigger = {
			wealth = 25
		}
		name = DWSOC7260B # Reusing quality localization
		wealth = -25
		change_variable = { which = "dw_lilith_temple_value" value = 4 }
		# ~ 60 days
		hidden_effect = {
			narrative_event = { id = DWSOC.7270 days = 55 random = 10 }
		}
	}
	option = { # low quality
		trigger = {
			wealth = 10
		}
		name = DWSOC7260C # Reusing quality localization
		wealth = -10
		change_variable = { which = "dw_lilith_temple_value" value = 2 }
		# ~ 60 days
		hidden_effect = {
			narrative_event = { id = DWSOC.7270 days = 40 random = 10 }
		}
	}
	option = { # Whatever is on hand
		name = DWSOC7260D # Reusing quality localization
		# ~ 30 days
		hidden_effect = {
			narrative_event = { id = DWSOC.7270 days = 25 random = 10 }
		}
	}
}

# Portable shrine
narrative_event = {
	id = DWSOC.7264
	title = dw_chosen_quest_title
	picture = lilith_society_lilith_temple1
	is_triggered_only = yes # by .7255
	desc = DWSOC7264
	option = { # high quality
		trigger = {
			wealth = 50
		}
		name = DWSOC7260A # Reusing quality localization
		wealth = -50
		change_variable = { which = "dw_lilith_temple_value" value = 6 }
		# ~ 60 days
		hidden_effect = {
			narrative_event = { id = DWSOC.7270 days = 70 random = 10 }
		}
	}
	option = { # medium quality
		trigger = {
			wealth = 25
		}
		name = DWSOC7260B # Reusing quality localization
		wealth = -25
		change_variable = { which = "dw_lilith_temple_value" value = 4 }
		# ~ 60 days
		hidden_effect = {
			narrative_event = { id = DWSOC.7270 days = 55 random = 10 }
		}
	}
	option = { # low quality
		trigger = {
			wealth = 10
		}
		name = DWSOC7260C # Reusing quality localization
		wealth = -10
		change_variable = { which = "dw_lilith_temple_value" value = 2 }
		# ~ 60 days
		hidden_effect = {
			narrative_event = { id = DWSOC.7270 days = 40 random = 10 }
		}
	}
	option = { # Whatever is on hand
		name = DWSOC7260D # Reusing quality localization
		# ~ 30 days
		hidden_effect = {
			narrative_event = { id = DWSOC.7270 days = 25 random = 10 }
		}
	}
}

# Private chambers
narrative_event = {
	id = DWSOC.7266
	title = dw_chosen_quest_title
	picture = lilith_society_lilith_temple1
	is_triggered_only = yes # by .7255
	desc = DWSOC7266
	option = { # high quality
		trigger = {
			wealth = 50
		}
		name = DWSOC7260A # Reusing quality localization
		wealth = -50
		change_variable = { which = "dw_lilith_temple_value" value = 6 }
		# ~ 60 days
		hidden_effect = {
			narrative_event = { id = DWSOC.7270 days = 70 random = 10 }
		}
	}
	option = { # medium quality
		trigger = {
			wealth = 25
		}
		name = DWSOC7260B # Reusing quality localization
		wealth = -25
		change_variable = { which = "dw_lilith_temple_value" value = 4 }
		# ~ 60 days
		hidden_effect = {
			narrative_event = { id = DWSOC.7270 days = 55 random = 10 }
		}
	}
	option = { # low quality
		trigger = {
			wealth = 10
		}
		name = DWSOC7260C # Reusing quality localization
		wealth = -10
		change_variable = { which = "dw_lilith_temple_value" value = 2 }
		# ~ 60 days
		hidden_effect = {
			narrative_event = { id = DWSOC.7270 days = 40 random = 10 }
		}
	}
	option = { # Whatever is on hand
		name = DWSOC7260D # Reusing quality localization
		# ~ 30 days
		hidden_effect = {
			narrative_event = { id = DWSOC.7270 days = 25 random = 10 }
		}
	}
}

# Temple Completed
narrative_event = {
	id = DWSOC.7270
	title = dw_chosen_quest_title
	picture = lilith_society_lilith_temple1
	is_triggered_only = yes # by .7255
	desc = DWSOC7270
	immediate = {
		# This is the variable we'll use for the final society reward determination
		set_variable = { which = "dw_chosen_of_lilith_quest_reward_value" which = dw_lilith_temple_value }
	}
	option = { # Praise Lilith
		name = DWSOC7270A
		piety = 50
		clr_quest = quest_the_chosen_of_lilith_build_temple
		# scripted_effect dw_chosen_of_lilith_quest_reward
		custom_tooltip = { text = dw_lilith_temple_quest_completion }
		hidden_effect = {
			if = {
				limit = {
					NOT = { has_character_flag = dw_nature_temple }
				}
				if = {
					limit = {
						is_feudal = yes
					}
					capital_holding = {
						add_building = dw_chapel_lilith
					}
				}
				else_if = {
					limit = {
						is_tribal = yes
					}
					capital_holding = {
						add_building = dw_lilith_shrine
					}
				}
				else_if = {
					limit = {
						is_merchant_republic = yes
					}
					capital_holding = {
						add_building = dw_lilith_temple
					}
				}
				else = {
					capital_holding = {
						add_building = dw_lilith_shrine_wagon
					}
				}
			}
			else = {
				if = {
					limit = {
						is_feudal = yes
					}
					capital_holding = {
						add_building = dw_lilith_shrine_outdoors_feudal
					}
				}
				else_if = {
					limit = {
						is_tribal = yes
					}
					capital_holding = {
						add_building = dw_lilith_shrine_outdoors_tribal
					}
				}
				else_if = {
					limit = {
						is_merchant_republic = yes
					}
					capital_holding = {
						add_building = dw_lilith_shrine_outdoors_merchant
					}
				}
				else = {
					capital_holding = {
						add_building = dw_lilith_shrine_outdoors
					}
				}
			}
		}
	}
	after = {
		hidden_effect = {
			clr_character_flag = dw_nature_temple
		}
	}
}

#MISSION: Sacrifice character
#Ping event for the mission Sacrifice Someone
character_event = {
	id = DWSOC.7024
	hide_window = yes

	is_triggered_only = yes

	immediate = { FROM = { society_quest_event = { id = DWSOC.7025 days = 7 random = 7 } } }
}

## For the character that gets the mission Sacrifice someone
society_quest_event = {
	id = DWSOC.7025
	desc = EVTDESC_MNM_7025
	border = GFX_event_letter_frame_intrigue

	is_triggered_only = yes

	immediate = {
		random_list = {
			10 = { set_character_flag = sacrifice_ruler }
			10 = { set_character_flag = sacrifice_holy_person }
			10 = { set_character_flag = sacrifice_virgin }
			5 = { set_character_flag = sacrifice_dwarf }
		}
	}

	option = {
		name = ACCEPT

		if = {
			limit = { has_character_flag = sacrifice_ruler }
			set_quest = quest_the_devil_worshipers_sacrifice_ruler	
		}
		if = {
			limit = { has_character_flag = sacrifice_holy_person }
			set_quest = quest_the_devil_worshipers_sacrifice_holy_person
		}
		if = {
			limit = { has_character_flag = sacrifice_virgin }
			set_quest = quest_the_devil_worshipers_sacrifice_virgin
		}
		if = {
			limit = { has_character_flag = sacrifice_dwarf }
			set_quest = quest_the_devil_worshipers_sacrifice_dwarf
		}
	}

	option = {
		name = DECLINE
		custom_tooltip = { text = decline_quest_tooltip }
		
		add_character_modifier = {
			name = quest_cooldown_timer
			hidden = yes
			days = 1000
		}

		ai_chance = { factor = 0 }
	}

	after = {
		hidden_effect = {
			clr_character_flag = sacrifice_ruler
			clr_character_flag = sacrifice_holy_person
			clr_character_flag = sacrifice_virgin
			clr_character_flag = sacrifice_dwarf
		}
	}
}
# The person being stuck gets this
narrative_event = {
	id = DWSOC.7500
	picture = lilith_society_sacrifice_1
	desc = DWSOC7500
	title = dw_society_sacrifice
	is_triggered_only = yes # via targetted_decision
	option = {
		name = DWSOC7500A
	}
}
# The person being stuck gets this
narrative_event = {
	id = DWSOC.7506
	picture = lilith_society_sacrifice_1
	desc = DWSOC7506
	title = dw_society_sacrifice
	is_triggered_only = yes # via targetted_decision
	option = {
		name = DWSOC7506A
	}
}



#MISSION: Demonic impregnation
#Ping event for the mission Demonic Impregnation
character_event = {
	id = DWSOC.7026
	hide_window = yes

	is_triggered_only = yes

	immediate = { FROM = { society_quest_event = { id = DWSOC.7027 days = 7 random = 7 } } }
}

## For the character that gets the mission Demonic Impregnation
society_quest_event = {
	id = DWSOC.7027
	desc = EVTDESC_MNM_7027

	is_triggered_only = yes

	option = {
		name = ACCEPT 
		set_quest = quest_the_chosen_of_lilith_demonic_impregnation
	}

	option = {
		name = DECLINE
		custom_tooltip = { text = decline_quest_tooltip }
		
		add_character_modifier = {
			name = quest_cooldown_timer
			hidden = yes
			days = 1000
		}

		ai_chance = { factor = 0 }
	}
}

###########################################
# Member Interaction Events
# Fired from 'on_society_bi_yearly_pulse'
# By Henrik Fahraeus
###########################################

###########################################
# Satanic Orgy - Hidden start
# Fired from on_society_bi_yearly_pulse
###########################################
character_event = {
	id = DWSOC.20000
	hide_window = yes
	
	is_triggered_only = yes
	
	only_playable = yes
	only_capable = yes
	prisoner = no
	is_in_society = yes
	
	trigger = {
		is_devil_worshiper_trigger = yes
		NOT = { is_inaccessible_trigger = yes }
		NOT = { trait = celibate }
		is_ill = no
	}
	
	weight_multiplier = {
		factor = 1
		modifier = {
			factor = 2.0
			trait = lustful
		}
		modifier = {
			factor = 1.5
			trait = hedonist
		}
		modifier = {
			factor = 3.0
			has_focus = focus_seduction
		}
		modifier = {
			factor = 0.5
			trait = chaste
		}
		modifier = {
			factor = 0.25
			has_character_flag = had_an_orgy
		}
	}
	
	immediate = {
		# First look for someone at court
		society = {
			random_society_member = {
				limit = {
					ai = yes
					is_incapable = no
					prisoner = no
					NOT = { is_inaccessible_trigger = yes }
					NOT = { trait = celibate }
					OR = {
						is_female = no
						NOT = { age = 45 }
						is_pregnant = no
						is_ill = no
					}
					NOT = { character = ROOT }
					in_command = no
					host = { character = ROOT }
				}
				character_event = { id = DWSOC.20001 }
				break = yes
			}
			
			# Then look for someone in the same realm
			random_society_member = {
				limit = {
					ai = yes
					is_incapable = no
					prisoner = no
					NOT = { is_inaccessible_trigger = yes }
					NOT = { trait = celibate }
					OR = {
						is_female = no
						NOT = { age = 45 }
						is_pregnant = no
						is_ill = no
					}
					NOT = { character = ROOT }
					in_command = no
					same_realm = ROOT
				}
				character_event = { id = DWSOC.20001 }
				break = yes
			}
			
			# Then look abroad...
			random_society_member = {
				limit = {
					ai = yes
					is_incapable = no
					prisoner = no
					NOT = { is_inaccessible_trigger = yes }
					NOT = { trait = celibate }
					OR = {
						is_female = no
						NOT = { age = 45 }
						is_pregnant = no
						is_ill = no
					}
					NOT = { character = ROOT }
					in_command = no
					is_within_diplo_range = ROOT
				}
				character_event = { id = DWSOC.20001 }
			}
		}
	}
}

# Bounce
character_event = {
	id = DWSOC.20001
	hide_window = yes
	
	is_triggered_only = yes
	
	immediate = {
		FROM = { character_event = { id = DWSOC.20002 } }
	}
}

# Satanic Orgy - Invitation
character_event = {
	id = DWSOC.20002
	picture = GFX_evt_sultan
	border = GFX_event_normal_frame_intrigue
	
	desc = {
		text = EVTDESC_MNM_20002
		trigger = {
			FROM = {
				NOT = { host = { character = ROOT } }
			}
		}
	}
	desc = {
		text = EVTDESC_MNM_20002_COURT
		trigger = {
			FROM = {
				host = { character = ROOT }
			}
		}
	}

	is_triggered_only = yes

	option = {
		name = EVTOPTA_MNM_20002 # Of course
		ai_chance = {
			factor = 100
		}
		
		FROM = { character_event = { id = DWSOC.20003 tooltip = EVT_TT_20003 } }
	}
	option = {
		name = EVTOPTB_MNM_20002 # No way!
		ai_chance = {
			factor = 1
			modifier = {
				factor = 200
				trait = chaste
			}
			modifier = {
				factor = 50
				trait = craven
			}
		}
		
		detract_society_currency_minor_effect = yes
		reverse_opinion = { who = FROM modifier = opinion_coward years = 5 }
	}
}

# Bounce
character_event = {
	id = DWSOC.20003
	hide_window = yes
	
	is_triggered_only = yes
	
	immediate = {
		save_event_target_as = sex_partner
		FROM = { character_event = { id = DWSOC.20004 days = 3 } }
	}
}

# Satanic Orgy - Aftermath
character_event = {
	id = DWSOC.20004
	picture = GFX_evt_bad_news
	border = GFX_event_normal_frame_intrigue
	
	is_triggered_only = yes
	
	immediate = {
		set_character_flag = had_an_orgy
	
		random = {
			chance = 50
			
			unprotected_sex_effect_event_target = yes
			set_character_flag = orgy_sex
			
			# Hetero
			if = {
				limit = {
					NOT = { same_sex = FROM }
				}
				if = {
					limit = {
						trait = homosexual
					}
					random = {
						chance = 50
						set_character_flag = orgy_lose_homo_trait
					}
				}
			}
			
			# Homo
			if = {
				limit = {
					same_sex = FROM
				}
				if = {
					limit = {
						NOT = { trait = homosexual }
					}
					random = {
						chance = 25
						set_character_flag = orgy_gain_homo_trait
					}
				}
			}
			
			# Gain Lover?
			if = {
				limit = {
					NOT = { is_lover = FROM }
					OR = {
						has_character_flag = orgy_lose_homo_trait
						has_character_flag = orgy_gain_homo_trait
						AND = {
							same_sex = FROM
							trait = homosexual
						}
						AND = {
							NOT = { same_sex = FROM }
							NOT = { trait = homosexual }
						}
					}
				}
				random = {
					chance = 50
					set_character_flag = orgy_lover
				}
			}
		}
		
		random_list = {
			100 = { # Become more lustful
				modifier = {
					factor = 0
					trait = lustful
				}
				set_character_flag = orgy_sex_lustify
			}
			20 = { # Gain a "sex dwarf"
				set_character_flag = orgy_sex_dwarf
				modifier = {
					factor = 0
					any_courtier = {
						trait = dwarf
					}
				}
			}
			100 = { # Gain the "Robust" trait
				modifier = {
					factor = 0
					trait = robust
				}
				set_character_flag = orgy_gain_robust
			}
			100 = { # Gain the "Feeble" trait
				modifier = {
					factor = 0
					trait = feeble
				}
				set_character_flag = orgy_gain_feeble
			}
			50 = { # Gain the "Cannibal" trait
				modifier = {
					factor = 0
					trait = cannibal_trait
				}
				set_character_flag = orgy_cannibal
			}
			100 = { # Gain a demonic blessing
				modifier = {
					factor = 0
					OR = {
						has_character_modifier = satyric_blessing
						has_character_modifier = blessing_of_lilith
					}
				}
				set_character_flag = orgy_blessing
			}
		}
		
		# Random courtier is ritually murdered
		random = {
			chance = 20
			random_courtier = {
				limit = {
					NOR = {
						character = ROOT
						character = FROM
						is_married = ROOT
						is_close_relative = ROOT
					}
					is_adult = yes
					prisoner = no
					is_ruler = no
					NOT = { same_society_as = ROOT }
				}
				ROOT = { set_character_flag = orgy_murder }
				save_event_target_as = orgy_casualty
				death = { death_reason = death_murder_unknown killer = ROOT }
			}
		}
	}
	
	desc = { 
		text = EVTDESC_MNM_20004
		picture = GFX_evt_sultan
		trigger = {
			NOT = { has_character_flag = orgy_sex }
		}
	}
	
	desc = { 
		text = EVTDESC_MNM_20004_SEX
		picture = GFX_evt_sultan
		trigger = {
			has_character_flag = orgy_sex
			OR = {
				AND = {
					same_sex = FROM
					trait = homosexual
				}
				AND = {
					NOT = { same_sex = FROM }
					NOT = { trait = homosexual }
				}
			}
		}
	}
	
	desc = { 
		text = EVTDESC_MNM_20004_ODD_SEX
		trigger = {
			has_character_flag = orgy_sex
			OR = {
				AND = {
					same_sex = FROM
					NOT = { trait = homosexual }
				}
				AND = {
					NOT = { same_sex = FROM }
					trait = homosexual
				}
			}
		}
	}

	option = {
		name = {
			text = EVTOPTA_MNM_20004_CANNIBAL
			trigger = {
				has_character_flag = orgy_cannibal
			}
		}
		name = {
			text = EVTOPTA_MNM_20004_GOOD # I feel good!
			trigger = {
				NOT = { has_character_flag = orgy_cannibal }
				OR = {
					has_character_flag = orgy_gain_robust
					has_character_flag = orgy_blessing
				}
			}
		}
		name = {
			text = EVTOPTA_MNM_20004_BAD # I feel drained...
			trigger = {
				NOT = { has_character_flag = orgy_cannibal }
				has_character_flag = orgy_gain_feeble
			}
		}
		name = {
			text = EVTOPTA_MNM_20004_CHANGE
			trigger = {
				NOT = { has_character_flag = orgy_cannibal }
				OR = {
					has_character_flag = orgy_gain_homo_trait
					has_character_flag = orgy_lose_homo_trait
				}
			}
		}
		
		name = {
			text = EVTOPTA_MNM_20004
			trigger = {
				NOR = {
					has_character_flag = orgy_cannibal
					has_character_flag = orgy_gain_robust
					has_character_flag = orgy_blessing
					has_character_flag = orgy_gain_feeble
					has_character_flag = orgy_gain_homo_trait
					has_character_flag = orgy_lose_homo_trait
				}
			}
		}
		
		# Dark Power gain
		add_society_currency_minor_effect = yes
		
		if = {
			limit = { has_character_flag = orgy_gain_homo_trait }
			add_trait = homosexual
		}
		
		if = {
			limit = { has_character_flag = orgy_lose_homo_trait }
			remove_trait = homosexual
		}
		
		if = {
			limit = { has_character_flag = orgy_lover }
			if = {
				limit = { NOT = { is_rival = FROM } }
				add_lover = FROM
			}
			
			if = {
				limit = { is_rival = FROM }
				remove_rival = FROM
			}
		}
		
		if = {
			limit = { has_character_flag = orgy_sex_lustify }
			if = {
				limit = { NOT = { trait = chaste } }
				add_trait = lustful
			}
			if = {
				limit = { trait = chaste }
				remove_trait = chaste
			}
		}
		
		if = {
			limit = { has_character_flag = orgy_sex_dwarf }
			create_character = {
				random_traits = no
				dynasty = none
				religion = FROM
				culture = FROM
				female = no
				age = 30
				attributes = {
					intrigue = 6
					diplomacy = 9
				}
				trait = elusive_shadow
				trait = dwarf
				trait = one_eyed
				trait = cruel
				trait = seducer
				trait = lustful
				trait = drunkard
				trait = ugly
				trait = gregarious
			}
			new_character = {
				set_character_flag = sex_dwarf
				
				if = {
					limit = {
						ROOT = {
							NOT = { has_character_flag = orgy_sex }
							OR = {
								is_female = yes
								trait = homosexual
							}
						}
					}
					save_event_target_as = sex_partner
					ROOT = { set_character_flag = orgy_sex_with_dwarf }
				}
			}
			if = {
				limit = { has_character_flag = orgy_sex_with_dwarf }
				unprotected_sex_effect_event_target = yes
			}
		}
		
		# Impregnated by unspecified participant
		if = {
			limit = {
				is_female = yes
				NOT = { age = 45 }
				fertility = 0.4
				is_pregnant = no
				NOR = {
					has_character_flag = orgy_sex_with_dwarf
					has_character_flag = orgy_sex
				}
				society = { any_society_member = { is_female = no prisoner = no fertility = 1 } }
			}
			hidden_tooltip = {
				random = {
					chance = 25
					society = {
						random_society_member = {
							limit = {
								is_female = no
								prisoner = no
								fertility = 1
							}
							save_event_target_as = impregnator
						}
					}
					impregnate_cuckoo = event_target:impregnator
					set_character_flag = orgy_impregnated
				}
			}
		}
		
		clr_character_flag = orgy_sex_with_dwarf
		
		if = {
			limit = { has_character_flag = orgy_gain_robust }
			if = {
				limit = { NOT = { trait = feeble } }
				add_trait = robust
			}
			if = {
				limit = { trait = feeble }
				remove_trait = feeble
			}
		}
		
		if = {
			limit = { has_character_flag = orgy_gain_feeble }
			if = {
				limit = { NOT = { trait = robust } }
				add_trait = feeble
			}
			if = {
				limit = { trait = robust }
				remove_trait = robust
			}
		}
		
		if = {
			limit = { has_character_flag = orgy_cannibal }
			add_trait = cannibal_trait
		}
		
		if = {
			limit = { has_character_flag = orgy_blessing }
			if = {
				limit = { is_female = yes }
				add_character_modifier = {
					modifier = blessing_of_lilith
					days = -1
				}
			}
			if = {
				limit = { is_female = no }
				add_character_modifier = {
					modifier = satyric_blessing
					days = -1
				}
			}
		}
		
		# Friend gained / Rivalry lost
		if = {
			limit = {
				NOR = {
					is_lover = FROM
					is_friend = FROM
					is_rival = FROM
				}
				random = 75
			}
			add_friend = FROM
		}
		if = {
			limit = {
				is_rival = FROM
			}
			remove_rival = FROM
		}
		
		if = {
			limit = {
				has_character_flag = orgy_murder
			}
			event_target:orgy_casualty = {
				death = { death_reason = death_murder_unknown killer = ROOT }
				show_portrait = yes
			}
		}
		
		clr_character_flag = orgy_sex
		clr_character_flag = orgy_lose_homo_trait
		clr_character_flag = orgy_gain_homo_trait
		clr_character_flag = orgy_lover
		clr_character_flag = orgy_sex_lustify
		clr_character_flag = orgy_sex_dwarf
		clr_character_flag = orgy_gain_robust
		clr_character_flag = orgy_gain_feeble
		clr_character_flag = orgy_cannibal
		clr_character_flag = orgy_blessing
		clr_character_flag = orgy_murder
	}
}

###########################################
# Satanic Night at the Town - Hidden start
# Fired from on_society_bi_yearly_pulse
###########################################
character_event = {
	id = DWSOC.20010
	hide_window = yes
	
	is_triggered_only = yes
	
	only_playable = yes
	only_capable = yes
	prisoner = no
	is_in_society = yes
	
	trigger = {
		is_devil_worshiper_trigger = yes
		NOT = { is_inaccessible_trigger = yes }
		is_ill = no
	}
	
	weight_multiplier = {
		factor = 1
		modifier = {
			factor = 1.25
			trait = impaler
		}
		modifier = {
			factor = 1.25
			trait = cruel
		}
		modifier = {
			factor = 1.25
			trait = arbitrary
		}
		modifier = {
			factor = 1.25
			trait = socializer
		}
		modifier = {
			factor = 1.25
			trait = drunkard
		}
		modifier = {
			factor = 1.25
			trait = gluttonous
		}
		modifier = {
			factor = 3.0
			has_focus = focus_carousing
		}
		modifier = {
			factor = 0.5
			trait = temperate
		}
		modifier = {
			factor = 0.5
			trait = just
		}
		modifier = {
			factor = 0.25
			trait = kind
		}
		modifier = {
			factor = 0.25
			has_character_flag = had_a_night_at_the_town
		}
	}
	
	immediate = {
		# First look for someone at court
		society = {
			random_society_member = {
				limit = {
					ai = yes
					is_incapable = no
					prisoner = no
					NOT = { is_inaccessible_trigger = yes }
					is_ill = no
					NOT = { character = ROOT }
					in_command = no
					host = { character = ROOT }
				}
				character_event = { id = DWSOC.20011 }
				break = yes
			}
			
			# Then look for someone in the same realm
			random_society_member = {
				limit = {
					ai = yes
					is_incapable = no
					prisoner = no
					NOT = { is_inaccessible_trigger = yes }
					is_ill = no
					NOT = { character = ROOT }
					in_command = no
					same_realm = ROOT
				}
				character_event = { id = DWSOC.20011 }
				break = yes
			}
			
			# Then look abroad...
			random_society_member = {
				limit = {
					ai = yes
					is_incapable = no
					prisoner = no
					NOT = { is_inaccessible_trigger = yes }
					is_ill = no
					NOT = { character = ROOT }
					in_command = no
					is_within_diplo_range = ROOT
				}
				character_event = { id = DWSOC.20011 }
			}
		}
	}
}

# Bounce
character_event = {
	id = DWSOC.20011
	hide_window = yes
	
	is_triggered_only = yes
	
	immediate = {
		FROM = { character_event = { id = DWSOC.20012 } }
	}
}

# Satanic Night at the Town - Invitation
character_event = {
	id = DWSOC.20012
	picture = GFX_evt_shady_meeting #GFX_evt_council
	border = GFX_event_normal_frame_intrigue
	
	desc = {
		text = EVTDESC_MNM_20012
		trigger = {
			FROM = {
				NOT = { host = { character = ROOT } }
			}
		}
	}
	desc = {
		text = EVTDESC_MNM_20012_COURT
		trigger = {
			FROM = {
				host = { character = ROOT }
			}
		}
	}

	is_triggered_only = yes

	option = {
		name = EVTOPTA_MNM_20012 # Of course
		ai_chance = {
			factor = 100
		}
		
		FROM = { character_event = { id = DWSOC.20013 tooltip = EVT_TT_20013 } }
	}
	option = {
		name = EVTOPTB_MNM_20012 # No way!
		ai_chance = {
			factor = 1
			modifier = {
				factor = 20
				trait = temperate
			}
			modifier = {
				factor = 10
				trait = kind
			}
			modifier = {
				factor = 10
				trait = just
			}
		}
		
		detract_society_currency_minor_effect = yes
		reverse_opinion = { who = FROM modifier = opinion_coward years = 5 }
	}
}

# Next step decided
character_event = {
	id = DWSOC.20013
	hide_window = yes
	
	is_triggered_only = yes
	
	immediate = {
		if = {
			limit = {
				FROM = {
					OR = {
						trait = arbitrary
						trait = wroth
						trait = cruel
						trait = impaler
						trait = lunatic
						trait = possessed
					}
				}
			}
			FROM = { character_event = { id = DWSOC.20014 days = 1 } }
			break = yes
		}
	
		FROM = { character_event = { id = DWSOC.20021 days = 2 } }
	}
}

# Satanic Night at the Town - Choice
character_event = {
	id = DWSOC.20014
	picture = GFX_evt_tribal_lands
	border = GFX_event_normal_frame_intrigue
	
	is_triggered_only = yes
	
	immediate = {
		set_character_flag = had_a_night_at_the_town
	}
	
	desc = {
		text = EVTDESC_MNM_20014
		picture = GFX_evt_stone_church
		trigger = {
			society_member_of = dw_the_chosen_of_lilith
		}
	}
	desc = {
		text = EVTDESC_MNM_20014_NOMAD
		picture = GFX_evt_nomad_camp
		trigger = {
			society_member_of = the_plaguebringers
			has_dlc = "Horse Lords"
		}
	}
	desc = {
		text = EVTDESC_MNM_20014_NOMAD
		trigger = {
			society_member_of = the_plaguebringers
			NOT = { has_dlc = "Horse Lords" }
		}
	}

	option = {
		name = EVTOPTA_MNM_20014 # Head for the town
		FROM = { character_event = { id = DWSOC.20020 days = 2 } }
	}
	
	option = {
		name = EVTOPTB_MNM_20014 # Home Invasion
		character_event = { id = DWSOC.20015 days = 2 tooltip = EVT_TT_20015 }
	}
}

# Home Invasion - Main event
character_event = {
	id = DWSOC.20015
	picture = GFX_evt_burning_house
	border = GFX_event_normal_frame_intrigue
	
	is_triggered_only = yes
	
	immediate = {
		# Chance of a bad effect
		random = {
			chance = 25
			random_list = {
				100 = { # Buddy dies
					modifier = {
						factor = 0
						FROMFROM = {
							is_ruler = yes
						}
					}
					set_character_flag = home_invasion_buddy_dies
				}
				100 = { # Wounded
					modifier = {
						factor = 0
						trait = wounded
					}
					set_character_flag = home_invasion_wounded
				}
				100 = { # Become Arbitrary
					modifier = {
						factor = 0
						trait = arbitrary
					}
					set_character_flag = home_invasion_gain_arbitrary
				}
				100 = { # Become Cannibal
					modifier = {
						factor = 0
						trait = cannibal_trait
					}
					set_character_flag = home_invasion_gain_cannibal
				}
			}
		}
		
		# Increased ambition?
		if = {
			limit = {
				NOT = { trait = ambitious }
			}
			random = {
				chance = 25
				set_character_flag = home_invasion_inc_ambition
			}
		}
		
		# Increased cruelty? (Cruel and Impaler)
		if = {
			limit = {
				OR = {
					NOT = { trait = cruel }
					NOT = { lifestyle_traits = 1 }
				}
			}
			random = {
				chance = 50
				set_character_flag = home_invasion_inc_cruelty
			}
		}
		
		# Remove stress?
		if = {
			limit = {
				trait = stressed
			}
			random = {
				chance = 25
				set_character_flag = home_invasion_remove_stress
			}
		}
		
		# Remove depression?
		if = {
			limit = {
				trait = depressed
				NOT = { trait = stressed }
			}
			random = {
				chance = 25
				set_character_flag = home_invasion_remove_depression
			}
		}
		
		# Chance of peasant revolt in case you leave the scene intact
		if = {
			limit = {
				location = {
					NAND = {
						has_empty_holding = yes
						owner = {
							is_nomadic = yes
						}
					}
					
					any_province_holding = {
						NOT = { holding_type = nomad }
					}
				}
			}
			random = {
				chance = 50
				set_character_flag = peasants_revolt
			}
		}
	}
	
	desc =  {
		trigger = {
			has_dlc = "Reapers"
			NOT = { has_character_flag = home_invasion_buddy_dies }
		}
		picture = GFX_evt_impalement
		text = EVTDESC_MNM_20015
	}
	desc =  {
		trigger = {
			NOT = { has_dlc = "Reapers" }
			NOT = { has_character_flag = home_invasion_buddy_dies }
		}
		text = EVTDESC_MNM_20015
	}
	desc =  {
		trigger = {
			has_dlc = "Reapers"
			has_character_flag = home_invasion_buddy_dies
		}
		picture = GFX_evt_impalement
		text = EVTDESC_MNM_20015_DEATH
	}
	desc =  {
		trigger = {
			NOT = { has_dlc = "Reapers" }
			has_character_flag = home_invasion_buddy_dies
		}
		text = EVTDESC_MNM_20015_DEATH
	}
	
	option = {
		name = EVTOPTA_MNM_20015 # Burn everything! No one must know.
		
		add_society_currency_minor_effect = yes
		
		# Buddy dies
		if = {
			limit = {
				has_character_flag = home_invasion_buddy_dies
			}
			FROMFROM = {
				death = { death_reason = death_accident }
			}
		}
		
		# Wounded
		if = {
			limit = {
				has_character_flag = home_invasion_wounded
			}
			add_trait = wounded
		}
		
		# Become Arbitrary
		if = {
			limit = {
				has_character_flag = home_invasion_gain_arbitrary
			}
			if = {
				limit = {
					NOT = { trait = just }
				}
				add_trait = arbitrary
			}
			if = {
				limit = {
					trait = just
				}
				remove_trait = just
			}
		}
		
		# Cannibal
		if = {
			limit = {
				has_character_flag = home_invasion_gain_cannibal
			}
			add_trait = cannibal_trait
		}
		
		# Ambition
		if = {
			limit = {
				has_character_flag = home_invasion_inc_ambition
			}
			if = {
				limit = {
					NOT = { trait = content }
				}
				add_trait = ambitious
			}
			if = {
				limit = {
					trait = content
				}
				remove_trait = content
			}
		}
		
		# Increase Cruelty
		if = {
			limit = {
				has_character_flag = home_invasion_inc_cruelty
			}
			if = {
				limit = {
					trait = cruel
					NOT = { lifestyle_traits = 1 }
				}
				add_trait = impaler
			}
			if = {
				limit = {
					NOT = { trait = kind }
					NOT = { trait = cruel }
				}
				add_trait = cruel
			}
			if = {
				limit = {
					trait = kind
				}
				remove_trait = kind
			}
		}
		
		# Relieve Stress
		if = {
			limit = {
				has_character_flag = home_invasion_remove_stress
			}
			remove_trait = stressed
		}
		
		# Cure Depression
		if = {
			limit = {
				has_character_flag = home_invasion_remove_depression
			}
			remove_trait = depressed
		}
		
		# Friend gained / Rivalry lost
		if = {
			limit = {
				NOT = { has_character_flag = home_invasion_buddy_dies }
				NOT = { is_friend = FROMFROM }
			}
			if = {
				limit = {
					NOR = {
						is_lover = FROMFROM
						is_friend = FROMFROM
						is_rival = FROMFROM
					}
				}
				add_friend = FROMFROM
			}
			if = {
				limit = {
					is_rival = FROMFROM
				}
				remove_rival = FROMFROM
			}
		}
		
		clr_character_flag = home_invasion_buddy_dies
		clr_character_flag = home_invasion_wounded
		clr_character_flag = home_invasion_gain_arbitrary
		clr_character_flag = home_invasion_gain_cannibal
		clr_character_flag = home_invasion_inc_ambition
		clr_character_flag = home_invasion_inc_cruelty
		clr_character_flag = home_invasion_remove_stress
		clr_character_flag = home_invasion_remove_depression
		clr_character_flag = peasants_revolt
	}
	
	option = {
		name = EVTOPTB_MNM_20015 # Leave it as a monument (risk of revolt)
		
		add_society_currency_medium_effect = yes
		
		# Buddy dies
		if = {
			limit = {
				has_character_flag = home_invasion_buddy_dies
			}
			FROMFROM = {
				death = { death_reason = death_accident }
			}
		}
		
		# Wounded
		if = {
			limit = {
				has_character_flag = home_invasion_wounded
			}
			add_trait = wounded
		}
		
		# Become Arbitrary
		if = {
			limit = {
				has_character_flag = home_invasion_gain_arbitrary
			}
			if = {
				limit = {
					NOT = { trait = just }
				}
				add_trait = arbitrary
			}
			if = {
				limit = {
					trait = just
				}
				remove_trait = just
			}
		}
		
		# Cannibal
		if = {
			limit = {
				has_character_flag = home_invasion_gain_cannibal
			}
			add_trait = cannibal_trait
		}
		
		# Ambition
		if = {
			limit = {
				has_character_flag = home_invasion_inc_ambition
			}
			if = {
				limit = {
					NOT = { trait = content }
				}
				add_trait = ambitious
			}
			if = {
				limit = {
					trait = content
				}
				remove_trait = content
			}
		}
		
		# Increase Cruelty
		if = {
			limit = {
				has_character_flag = home_invasion_inc_cruelty
			}
			if = {
				limit = {
					trait = cruel
					NOT = { lifestyle_traits = 1 }
				}
				add_trait = impaler
			}
			if = {
				limit = {
					NOT = { trait = kind }
					NOT = { trait = cruel }
				}
				add_trait = cruel
			}
			if = {
				limit = {
					trait = kind
				}
				remove_trait = kind
			}
		}
		
		# Relieve Stress
		if = {
			limit = {
				has_character_flag = home_invasion_remove_stress
			}
			remove_trait = stressed
		}
		
		# Cure Depression
		if = {
			limit = {
				has_character_flag = home_invasion_remove_depression
			}
			remove_trait = depressed
		}
		
		# Blessing of Berith
		if = {
			limit = {
				NOT = { has_character_modifier = blessing_of_berith }
			}
			add_character_modifier = {
				modifier = blessing_of_berith
				years = 5
			}
		}
		
		# Friend gained / Rivalry lost
		if = {
			limit = {
				NOT = { has_character_flag = home_invasion_buddy_dies }
				NOT = { is_friend = FROMFROM }
			}
			if = {
				limit = {
					NOR = {
						is_lover = FROMFROM
						is_friend = FROMFROM
						is_rival = FROMFROM
					}
				}
				add_friend = FROMFROM
			}
			if = {
				limit = {
					is_rival = FROMFROM
				}
				remove_rival = FROMFROM
			}
		}
		
		if = {
			limit = { NOT = { has_character_flag = peasants_revolt } }
			character_event = { id = DWSOC.20016 days = 3 tooltip = EVT_TT_20016 }
		}
		
		if = {
			limit = { has_character_flag = peasants_revolt }
			clr_character_flag = peasants_revolt
			character_event = { id = DWSOC.20017 days = 3 tooltip = EVT_TT_20016 }
		}
		
		clr_character_flag = home_invasion_buddy_dies
		clr_character_flag = home_invasion_wounded
		clr_character_flag = home_invasion_gain_arbitrary
		clr_character_flag = home_invasion_gain_cannibal
		clr_character_flag = home_invasion_inc_ambition
		clr_character_flag = home_invasion_inc_cruelty
		clr_character_flag = home_invasion_remove_stress
		clr_character_flag = home_invasion_remove_depression
	}
}

# Home Invasion - Demonic Monument outcome - increased revolt risk
character_event = {
	id = DWSOC.20016
	picture = GFX_evt_peasants
	border = GFX_event_normal_frame_intrigue
	
	desc = EVTDESC_MNM_20016
	
	is_triggered_only = yes
	
	immediate = {
		location = {
			add_province_modifier = {
				modifier = rumors_of_witchcraft
				years = 3
			}
		}
	}
	
	option = {
		name = EVTOPTA_MNM_20016
	}
}

# Home Invasion - Demonic Monument outcome - rebellion
character_event = {
	id = DWSOC.20017
	picture = GFX_evt_peasants
	border = GFX_event_normal_frame_intrigue
	
	desc = EVTDESC_MNM_20017
	
	is_triggered_only = yes
	
	immediate = {
		location = {
			set_province_flag = force_peasant_revolt
			province_event = { id = TOG.1000 }
			clr_province_flag = force_peasant_revolt
		}
	}
	
	option = {
		name = EVTOPTA_MNM_20017
		trigger = {
			location = {
				owner = {
					OR = {
						character = ROOT
						is_liege_or_above = ROOT
					}
				}
			}
		}
	}
	
	option = {
		name = EVTOPTA_MNM_20017_OTHER
		trigger = {
			location = {
				owner = {
					NOR = {
						character = ROOT
						is_liege_or_above = ROOT
					}
				}
			}
		}
	}
}


# Night at the tavern - Bounce
character_event = {
	id = DWSOC.20020
	hide_window = yes
	
	is_triggered_only = yes
	
	immediate = {
		FROM = { character_event = { id = DWSOC.20021 } }
	}
}

# Debauchery at the Tavern - Main event
character_event = {
	id = DWSOC.20021
	picture = GFX_evt_brothel
	border = GFX_event_normal_frame_intrigue
	
	is_triggered_only = yes
	
	immediate = {
		# Gain Wroth?
		if = {
			limit = {
				NOT = { trait = wroth }
			}
			random = {
				chance = 25
				set_character_flag = nt_gain_wroth
			}
		}
		
		# Gain Cruel?
		if = {
			limit = {
				NOT = { trait = cruel }
			}
			random = {
				chance = 50
				set_character_flag = nt_gain_cruel
			}
		}
		
		# Remove stress?
		if = {
			limit = {
				trait = stressed
			}
			random = {
				chance = 25
				set_character_flag = nt_remove_stress
			}
		}
		
		# Remove depression?
		if = {
			limit = {
				trait = depressed
				NOT = { trait = stressed }
			}
			random = {
				chance = 25
				set_character_flag = nt_remove_depression
			}
		}
		
		# Friendship or Rivalry?
		if = {
			limit = {
				NOT = { is_lover = FROM }
			}
			random_list = {
				100 = {
					modifier = {
						factor = 0
						is_friend = FROM
					}
					set_character_flag = nt_bonding
				}
				20 = {
					modifier = {
						factor = 0
						is_rival = FROM
					}
					set_character_flag = nt_rivalry
				}
			}
		}
		
		# Oops, I drank the beer.
		random = {
			chance = 20
			modifier = {
				factor = 0.5
				trait = shrewd
			}
			modifier = {
				factor = 0.5
				trait = quick
			}
			modifier = {
				factor = 0.25
				trait = genius
			}
			modifier = {
				factor = 3.0
				trait = slow
			}
			modifier = {
				factor = 2.0
				trait = dull
			}
			modifier = {
				factor = 2.0
				trait = drunkard
			}
			modifier = {
				factor = 2.0
				trait = hedonist
			}
			modifier = {
				factor = 5.0
				trait = imbecile
			}
			set_character_flag = nt_drank_the_beer
		}
	}
	
	desc = {
		trigger = {
			NOT = { has_character_flag = nt_rivalry }
		}
		text = EVTDESC_MNM_20021
	}
	
	desc = {
		trigger = {
			has_character_flag = nt_rivalry
		}
		text = EVTDESC_MNM_20021_RIVALRY
	}
	
	option = {
		name = {
			trigger = {
				has_character_flag = nt_rivalry
				NOT = { has_character_flag = nt_drank_the_beer }
			}
			text = EVTOPTA_MNM_20021_RIVALRY
		}
		
		name = {
			trigger = {
				NOT = { has_character_flag = nt_drank_the_beer }
				NOT = { has_character_flag = nt_rivalry }
			}
			text = EVTOPTA_MNM_20021
		}
		
		name = {
			trigger = {
				has_character_flag = nt_drank_the_beer
			}
			text = EVTOPTA_MNM_20021_OOPS
		}
		
		add_society_currency_minor_effect = yes
		
		# Gain Wroth
		if = {
			limit = {
				has_character_flag = nt_gain_wroth
			}
			if = {
				limit = {
					NOT = { trait = patient }
				}
				add_trait = wroth
			}
			if = {
				limit = {
					trait = patient
				}
				remove_trait = patient
			}
		}
		
		# Gain Cruel
		if = {
			limit = {
				has_character_flag = nt_gain_cruel
			}
			if = {
				limit = {
					NOT = { trait = kind }
				}
				add_trait = cruel
			}
			if = {
				limit = {
					trait = kind
				}
				remove_trait = kind
			}
		}
		
		# Relieve Stress
		if = {
			limit = {
				has_character_flag = nt_remove_stress
			}
			remove_trait = stressed
		}
		
		# Cure Depression
		if = {
			limit = {
				has_character_flag = nt_remove_depression
			}
			remove_trait = depressed
		}
		
		# Friend gained
		if = {
			limit = {
				has_character_flag = nt_bonding
			}
			if = {
				limit = {
					NOR = {
						is_lover = FROM
						is_friend = FROM
						is_rival = FROM
					}
				}
				add_friend = FROM
			}
			if = {
				limit = {
					is_rival = FROM
				}
				remove_rival = FROM
			}
		}
		
		# Rival gained
		if = {
			limit = {
				has_character_flag = nt_rivalry
			}
			if = {
				limit = {
					NOR = {
						is_friend = FROM
						is_rival = FROM
					}
				}
				add_rival = FROM
			}
			if = {
				limit = {
					is_friend = FROM
				}
				remove_friend = FROM
			}
		}
		
		if = {
			limit = {
				has_character_flag = nt_drank_the_beer
			}
			character_event = { id = DWSOC.20022 days = 1 tooltip = EVT_TT_20022 }
		}
		
		clr_character_flag = nt_gain_wroth
		clr_character_flag = nt_gain_cruel
		clr_character_flag = nt_remove_stress
		clr_character_flag = nt_remove_depression
		clr_character_flag = nt_bonding
		clr_character_flag = nt_rivalry
		clr_character_flag = nt_drank_the_beer
	}
}

# Debauchery at the Tavern - Drank the drugged beer
character_event = {
	id = DWSOC.20022
	picture = GFX_evt_drunk
	border = GFX_event_normal_frame_intrigue
	
	is_triggered_only = yes
	
	immediate = {
		random_list = {
			100 = {
				modifier = {
					factor = 0
					trait = drunkard
				}
				set_character_flag = nt_gain_drunkard
			}
			25 = {
				modifier = {
					factor = 0
					trait = lunatic
				}
				set_character_flag = nt_gain_lunatic
			}
			100 = {
				set_character_flag = nt_grow_dumber
			}
			100 = {
				modifier = {
					factor = 0
					has_character_modifier = hallucinating
				}
				set_character_flag = nt_bad_modifier
			}
		}
	}
	
	desc = EVTDESC_MNM_20022
	
	option = {
		name = EVTOPTA_MNM_20022
		
		# Become a drunkard
		if = {
			limit = {
				has_character_flag = nt_gain_drunkard
			}
			add_trait = drunkard
		}
		
		#Go insane
		if = {
			limit = {
				has_character_flag = nt_gain_lunatic
			}
			add_trait = lunatic
		}
		
		#Brain damage
		if = {
			limit = {
				has_character_flag = nt_grow_dumber
			}
			if = {
				limit = {
					NOR = {
						trait = dull
						trait = shrewd
						trait = genius
						trait = quick
						trait = slow
						trait = imbecile
					}
				}
				add_trait = dull
			}
			if = {
				limit = {
					trait = slow
				}
				remove_trait = slow
				add_trait = imbecile
			}
			if = {
				limit = {
					trait = shrewd
				}
				remove_trait = shrewd
			}
			if = {
				limit = {
					trait = quick
				}
				remove_trait = quick
			}
			if = {
				limit = {
					trait = genius
				}
				remove_trait = genius
				add_trait = quick
			}
		}
		
		# Poisoned
		if = {
			limit = {
				has_character_flag = nt_bad_modifier
			}
			add_character_modifier = {
				name = hallucinating
				days = 120
			}
		}
		
		clr_character_flag = nt_gain_drunkard
		clr_character_flag = nt_gain_lunatic
		clr_character_flag = nt_grow_dumber
		clr_character_flag = nt_bad_modifier
	}
}

###########################################
# Grand Demon Summoning - Hidden start
# Fired from on_society_bi_yearly_pulse
###########################################

character_event = {
	id = DWSOC.20030
	hide_window = yes
	
	is_triggered_only = yes
	
	only_playable = yes
	only_capable = yes
	prisoner = no
	is_in_society = yes
	
	trigger = {
		is_devil_worshiper_trigger = yes
		NOT = { is_inaccessible_trigger = yes }
		is_ill = no
	}
	
	weight_multiplier = {
		factor = 1
		modifier = {
			factor = 2.0
			society_rank >= 3
		}
		modifier = {
			factor = 0.5
			society_rank == 1
		}
		modifier = {
			factor = 3.0
			OR = {
				has_focus = focus_scholarship
				has_focus = focus_theology
			}
		}
		modifier = {
			factor = 3.0
			trait = genius
		}
		modifier = {
			factor = 3.0
			trait = mystic
		}
		modifier = {
			factor = 2.0
			trait = quick
		}
		modifier = {
			factor = 2.0
			trait = shrewd
		}
		modifier = {
			factor = 0.5
			trait = dull
		}
		modifier = {
			factor = 0.5
			trait = slow
		}
		modifier = {
			factor = 0.1
			trait = imbecile
		}
		modifier = {
			factor = 0.25
			has_character_flag = had_a_grand_demon_summoning
		}
	}
	
	immediate = {
		# First look for someone at court
		society = {
			random_society_member = {
				limit = {
					ai = yes
					is_incapable = no
					prisoner = no
					NOT = { is_inaccessible_trigger = yes }
					is_ill = no
					NOT = { character = ROOT }
					in_command = no
					host = { character = ROOT }
				}
				character_event = { id = DWSOC.20031 }
				break = yes
			}
			
			# Then look for someone in the same realm
			random_society_member = {
				limit = {
					ai = yes
					is_incapable = no
					prisoner = no
					NOT = { is_inaccessible_trigger = yes }
					is_ill = no
					NOT = { character = ROOT }
					in_command = no
					same_realm = ROOT
				}
				character_event = { id = DWSOC.20031 }
				break = yes
			}
			
			# Then look abroad...
			random_society_member = {
				limit = {
					ai = yes
					is_incapable = no
					prisoner = no
					NOT = { is_inaccessible_trigger = yes }
					is_ill = no
					NOT = { character = ROOT }
					in_command = no
					is_within_diplo_range = ROOT
				}
				character_event = { id = DWSOC.20031 }
			}
		}
	}
}

# Bounce
character_event = {
	id = DWSOC.20031
	hide_window = yes
	
	is_triggered_only = yes
	
	immediate = {
		FROM = { narrative_event = { id = DWSOC.20032 } }
	}
}

# Demon Summoning - Planning
narrative_event = {
	id = DWSOC.20032
	picture = GFX_evt_shadowy_cabal
	border = GFX_event_narrative_frame_intrigue
	
	title = EVTTITLE_MNM_20034
	
	desc = {
		text = EVTDESC_MNM_20032
		trigger = {
			FROM = {
				NOT = { host = { character = ROOT } }
			}
		}
	}
	desc = {
		text = EVTDESC_MNM_20032_COURT
		trigger = {
			FROM = {
				host = { character = ROOT }
			}
		}
	}

	is_triggered_only = yes

	option = {
		name = EVTOPTA_MNM_20032 # Unlimited Power!
		ai_chance = {
			factor = 100
			modifier = {
				factor = 50
				trait = ambitious
			}
			modifier = {
				factor = 50
				trait = mystic
			}
		}
		
		set_character_flag = had_a_grand_demon_summoning
		
		FROM = { character_event = { id = DWSOC.20033 tooltip = EVT_TT_20033 } }
	}
	option = {
		name = EVTOPTB_MNM_20032 # Let's think this through
		ai_chance = {
			factor = 1
			modifier = {
				factor = 50
				trait = craven
			}
			modifier = {
				factor = 25
				trait = content
			}
		}
		
		detract_society_currency_minor_effect = yes
		reverse_opinion = { who = FROM modifier = opinion_coward years = 5 }
	}
}

# Bounce
character_event = {
	id = DWSOC.20033
	hide_window = yes
	
	is_triggered_only = yes
	
	immediate = {
		FROM = { narrative_event = { id = DWSOC.20034 days = 3  } }
	}
}

# Demon Summoning - The Ritual
narrative_event = {
	id = DWSOC.20034
	picture = GFX_evt_magic_ritual
	border = GFX_event_narrative_frame_intrigue
	
	title = EVTTITLE_MNM_20034
	
	immediate = {
		hidden_effect = {
			random_list = {
				100 = { # Stewardship Demon
					modifier = {
						factor = 0
						has_character_modifier = blessing_of_mammon
						NOR = {
							trait = indulgent_wastrel
							trait = thrifty_clerk
							trait = fortune_builder
						}
					}
					modifier = {
						factor = 2
						OR = {
							trait = indulgent_wastrel
							trait = thrifty_clerk
							trait = fortune_builder
							trait = midas_touched
						}
					}
					modifier = {
						factor = 2
						OR = {
							has_focus = focus_rulership
							has_focus = focus_business
						}
					}
					set_character_flag = ds_STE
				}
				100 = { # Diplomacy Demon
					modifier = {
						factor = 0
						has_character_modifier = blessing_of_belial
						NOR = {
							trait = naive_appeaser
							trait = underhanded_rogue
							trait = charismatic_negotiator
						}
					}
					modifier = {
						factor = 2
						OR = {
							trait = naive_appeaser
							trait = underhanded_rogue
							trait = charismatic_negotiator
							trait = grey_eminence
						}
					}
					modifier = {
						factor = 2
						OR = {
							has_focus = focus_family
							has_focus = focus_carousing
						}
					}
					set_character_flag = ds_DIP
				}
				100 = { # Martial Demon
					modifier = {
						factor = 0
						has_character_modifier = blessing_of_azazel
						NOR = {
							trait = misguided_warrior
							trait = tough_soldier
							trait = skilled_tactician
						}
					}
					modifier = {
						factor = 2
						OR = {
							trait = misguided_warrior
							trait = tough_soldier
							trait = skilled_tactician
							trait = brilliant_strategist
						}
					}
					modifier = {
						factor = 2
						OR = {
							has_focus = focus_war
							has_focus = focus_hunting
						}
					}
					set_character_flag = ds_MAR
				}
				100 = { # Intrigue Demon
					modifier = {
						factor = 0
						NOT = {
							any_rival = {
								always = yes
							}
						}
						has_character_modifier = blessing_of_vetis
						NOR = {
							trait = amateurish_plotter
							trait = flamboyant_schemer
							trait = intricate_webweaver
						}
					}
					modifier = {
						factor = 2
						OR = {
							trait = amateurish_plotter
							trait = flamboyant_schemer
							trait = intricate_webweaver
							trait = elusive_shadow
						}
					}
					modifier = {
						factor = 2
						OR = {
							has_focus = focus_seduction
							has_focus = focus_intrigue
						}
					}
					random_rival = {
						ROOT = { set_character_flag = ds_kill_a_rival_1 }
						save_event_target_as = rival_1
					}
					random_rival = {
						limit = {
							NOT = { character = event_target:rival_1 }
						}
						ROOT = { set_character_flag = ds_kill_a_rival_2 }
						save_event_target_as = rival_2
					}
					set_character_flag = ds_INT
				}
				100 = { # Learning Demon
					modifier = {
						factor = 0
						has_character_modifier = blessing_of_avnas
						NOR = {
							trait = detached_priest
							trait = martial_cleric
							trait = scholarly_theologian
							trait = shrewd
						}
					}
					modifier = {
						factor = 2
						OR = {
							trait = detached_priest
							trait = martial_cleric
							trait = scholarly_theologian
							trait = mastermind_theologian
						}
					}
					modifier = {
						factor = 2
						OR = {
							has_focus = focus_scholarship
							has_focus = focus_theology
						}
					}
					set_character_flag = ds_LEA
				}
				100 = { # Disaster!
					modifier = {
						factor = 0.5
						trait = genius
					}
					modifier = {
						factor = 0.5
						trait = mystic
					}
					modifier = {
						factor = 0.75
						trait = quick
					}
					modifier = {
						factor = 0.75
						trait = shrewd
					}
					modifier = {
						factor = 2.0
						trait = slow
					}
					modifier = {
						factor = 2.0
						trait = dull
					}
					modifier = {
						factor = 5.0
						trait = imbecile
					}
					modifier = {
						factor = 3.0
						trait = inbred
					}
					random_list = {
						100 = {
							set_character_flag = ds_illness
						}
						100 = {
							modifier = {
								factor = 0
								location = {
									has_disease = yes
								}
							}
							set_character_flag = ds_epidemic
						}
						100 = {
							modifier = {
								factor = 0
								OR = {
									is_female = yes
									trait = eunuch
								}
							}
							set_character_flag = ds_eunuch
						}
						100 = {
							set_character_flag = ds_stupid
						}
						100 = {
							modifier = {
								factor = 0
								has_character_modifier = known_witch
							}
							set_character_flag = ds_exposure
						}
						100 = {
							modifier = {
								factor = 0
								is_rival = FROM
							}
							set_character_flag = ds_rivalry
						}
						100 = {
							modifier = {
								factor = 0
								trait = possessed
							}
							set_character_flag = ds_possess
						}
					}
					
					set_character_flag = ds_disaster
				}
			}
		}
	}
	
	desc = {
		trigger = {
			NOT = { has_character_flag = ds_disaster }
		}
		text = EVTDESC_MNM_20034
	}
	desc = {
		trigger = {
			has_character_flag = ds_disaster
		}
		text = EVTOPTA_MNM_20034_DISASTER
	}

	is_triggered_only = yes
	
	option = {
		name = EVTOPTA_MNM_20034
		trigger = {
			NOT = { has_character_flag = ds_disaster }
		}
		
		add_society_currency_minor_effect = yes
		
		increase_visibility_effect = yes
		
		# Stewardship Boon
		if = {
			limit = {
				has_character_flag = ds_STE
			}
			if = {
				limit = {
					has_character_modifier = blessing_of_mammon
				}
				if = {
					limit = { trait = fortune_builder }
					hidden_tooltip = { remove_trait = fortune_builder }
					add_trait = midas_touched
				}
				if = {
					limit = { trait = thrifty_clerk }
					hidden_tooltip = { remove_trait = thrifty_clerk }
					add_trait = fortune_builder
				}
				if = {
					limit = { trait = indulgent_wastrel }
					hidden_tooltip = { remove_trait = indulgent_wastrel }
					add_trait = thrifty_clerk
				}
			}
			if = {
				limit = {
					NOT = { has_character_modifier = blessing_of_mammon }
				}
				add_character_modifier = {
					modifier = blessing_of_mammon
					days = -1
				}
			}
		}
		
		# Diplomacy Boon
		if = {
			limit = {
				has_character_flag = ds_DIP
			}
			if = {
				limit = {
					has_character_modifier = blessing_of_belial
				}
				if = {
					limit = { trait = charismatic_negotiator }
					hidden_tooltip = { remove_trait = charismatic_negotiator }
					add_trait = grey_eminence
				}
				if = {
					limit = { trait = underhanded_rogue }
					hidden_tooltip = { remove_trait = underhanded_rogue }
					add_trait = charismatic_negotiator
				}
				if = {
					limit = { trait = naive_appeaser }
					hidden_tooltip = { remove_trait = naive_appeaser }
					add_trait = underhanded_rogue
				}
			}
			if = {
				limit = {
					NOT = { has_character_modifier = blessing_of_belial }
				}
				add_character_modifier = {
					modifier = blessing_of_belial
					days = -1
				}
			}
		}
		
		# Martial Boon
		if = {
			limit = {
				has_character_flag = ds_MAR
			}
			if = {
				limit = {
					has_character_modifier = blessing_of_azazel
				}
				if = {
					limit = { trait = skilled_tactician }
					hidden_tooltip = { remove_trait = skilled_tactician }
					add_trait = brilliant_strategist
				}
				if = {
					limit = { trait = tough_soldier }
					hidden_tooltip = { remove_trait = tough_soldier }
					add_trait = skilled_tactician
				}
				if = {
					limit = { trait = misguided_warrior }
					hidden_tooltip = { remove_trait = misguided_warrior }
					add_trait = tough_soldier
				}
			}
			if = {
				limit = {
					NOT = { has_character_modifier = blessing_of_azazel }
				}
				add_character_modifier = {
					modifier = blessing_of_azazel
					days = -1
				}
			}
		}
		
		# Intrigue Boon
		if = {
			limit = {
				has_character_flag = ds_INT
			}
			if = {
				limit = {
					has_character_modifier = blessing_of_vetis
				}
				if = {
					limit = { trait = intricate_webweaver }
					hidden_tooltip = { remove_trait = intricate_webweaver }
					add_trait = elusive_shadow
				}
				if = {
					limit = { trait = flamboyant_schemer }
					hidden_tooltip = { remove_trait = flamboyant_schemer }
					add_trait = intricate_webweaver
				}
				if = {
					limit = { trait = amateurish_plotter }
					hidden_tooltip = { remove_trait = amateurish_plotter }
					add_trait = flamboyant_schemer
				}
			}
			if = {
				limit = {
					NOT = { has_character_modifier = blessing_of_vetis }
				}
				add_character_modifier = {
					modifier = blessing_of_vetis
					days = -1
				}
			}
		}
		
		# Learning Boon
		if = {
			limit = {
				has_character_flag = ds_LEA
			}
			if = {
				limit = {
					has_character_modifier = blessing_of_avnas
				}
				if = {
					limit = { trait = scholarly_theologian }
					hidden_tooltip = { remove_trait = scholarly_theologian }
					add_trait = mastermind_theologian
					set_character_flag = ds_better_ed
				}
				if = {
					limit = { trait = martial_cleric }
					hidden_tooltip = { remove_trait = martial_cleric }
					add_trait = scholarly_theologian
					set_character_flag = ds_better_ed
				}
				if = {
					limit = { trait = detached_priest }
					hidden_tooltip = { remove_trait = detached_priest }
					add_trait = martial_cleric
					set_character_flag = ds_better_ed
				}
				if = {
					limit = { NOT = { has_character_flag = ds_better_ed } }
					if = {
						limit = { NOT = { trait = dull } }
						add_trait = shrewd
					}
					if = {
						limit = { trait = dull }
						remove_trait = dull
					}
				}
				
				clr_character_flag = ds_better_ed
			}
			if = {
				limit = {
					NOT = { has_character_modifier = blessing_of_avnas }
				}
				add_character_modifier = {
					modifier = blessing_of_avnas
					days = -1
				}
			}
		}
		
		clr_character_flag = ds_INT
		clr_character_flag = ds_STE
		clr_character_flag = ds_MAR
		clr_character_flag = ds_DIP
		clr_character_flag = ds_LEA
		clr_character_flag = ds_kill_a_rival_1
		clr_character_flag = ds_kill_a_rival_2
	}

	option = {
		trigger = {
			has_character_flag = ds_disaster
		}
		
		name = {
			text = EVTOPTA_MNM_20034_ILLNESS
			trigger = {
				has_character_flag = ds_illness
			}
		}
		name = {
			text = EVTOPTA_MNM_20034_EPIDEMIC
			trigger = {
				has_character_flag = ds_epidemic
			}
		}
		name = {
			text = EVTOPTA_MNM_20034_EUNUCH
			trigger = {
				has_character_flag = ds_eunuch
			}
		}
		name = {
			text = EVTOPTA_MNM_20034_STUPID
			trigger = {
				has_character_flag = ds_stupid
			}
		}
		name = {
			text = EVTOPTA_MNM_20034_EXPOSURE
			trigger = {
				has_character_flag = ds_exposure
			}
		}
		name = {
			text = EVTOPTA_MNM_20034_POSSESS
			trigger = {
				has_character_flag = ds_possess
			}
		}
		name = {
			text = EVTOPTA_MNM_20034_RIVALRY
			trigger = {
				has_character_flag = ds_rivalry
			}
		}
		
		if = {
			limit = {
				has_character_flag = ds_illness
			}
			if = {
				limit = {
					has_dlc = "Reapers"
				}
				add_trait = cancer
			}
		}
		
		if = {
			limit = {
				has_character_flag = ds_epidemic
			}
			location = {
				spawn_disease = typhoid_fever
			}
		}
		
		if = {
			limit = {
				has_character_flag = ds_eunuch
			}
			add_trait = eunuch
		}
		
		if = {
			limit = {
				has_character_flag = ds_stupid
			}
			if = {
				limit = {
					NOR = {
						trait = dull
						trait = shrewd
						trait = genius
						trait = quick
						trait = slow
						trait = imbecile
					}
				}
				add_trait = dull
			}
			if = {
				limit = {
					trait = slow
				}
				remove_trait = slow
				add_trait = imbecile
			}
			if = {
				limit = {
					trait = shrewd
				}
				remove_trait = shrewd
			}
			if = {
				limit = {
					trait = quick
				}
				remove_trait = quick
			}
			if = {
				limit = {
					trait = genius
				}
				remove_trait = genius
				add_trait = quick
			}
		}
		
		if = {
			limit = {
				has_character_flag = ds_exposure
			}
			if = {
				limit = {
					NOR = {
						has_character_modifier = suspected_witch
						has_character_modifier = known_witch
					}
				}
				add_character_modifier = {
					name = suspected_witch
					duration = -1
				}
			}
			
			if = {
				limit = { has_character_modifier = suspected_witch }
				remove_character_modifier = suspected_witch
				add_character_modifier = {
					name = known_witch
					duration = -1
				}
			}
		}
		
		if = {
			limit = {
				has_character_flag = ds_possess
			}
			add_trait = possessed
			add_character_modifier = {
				name = voice_of_satan
				duration = -1
			}
		}
		
		if = {
			limit = {
				has_character_flag = ds_rivalry
			}
			if = {
				limit = {
					NOR ={
						is_lover = FROM
						is_friend = FROM
					}
				}
				add_rival = FROM
			}
			if = {
				limit = {
					is_lover = FROM
				}
				remove_lover = FROM
			}
			if = {
				limit = {
					is_friend = FROM
				}
				remove_friend = FROM
			}
		}
		
		clr_character_flag = ds_disaster
		clr_character_flag = ds_illness
		clr_character_flag = ds_epidemic
		clr_character_flag = ds_eunuch
		clr_character_flag = ds_stupid
		clr_character_flag = ds_exposure
		clr_character_flag = ds_possess
		clr_character_flag = ds_rivalry
	}
	
	option = {
		name = EVTOPTA_MNM_20034_KILL_RIVAL_1
		trigger = {
			has_character_flag = ds_kill_a_rival_1
		}
		
		add_society_currency_minor_effect = yes
		
		increase_visibility_effect = yes
		
		event_target:rival_1 = {
			tooltip = {
				death = { death_reason = death_murder_unknown killer = ROOT }
			}
			character_event = { id = DWSOC.20035 }
		}
		
		clr_character_flag = ds_INT
		clr_character_flag = ds_kill_a_rival_1
		clr_character_flag = ds_kill_a_rival_2
	}
	
	option = {
		name = EVTOPTA_MNM_20034_KILL_RIVAL_2
		trigger = {
			has_character_flag = ds_kill_a_rival_2
		}
		
		add_society_currency_minor_effect = yes
		
		increase_visibility_effect = yes
		
		event_target:rival_2 = {
			tooltip = {
				death = { death_reason = death_murder_unknown killer = ROOT }
			}
			character_event = { id = DWSOC.20035 }
		}
		
		clr_character_flag = ds_INT
		clr_character_flag = ds_kill_a_rival_1
		clr_character_flag = ds_kill_a_rival_2
	}
}

# Demon Summoning - Rival is killed
character_event = {
	id = DWSOC.20035
	picture = GFX_evt_magic_ritual
	border = GFX_event_normal_frame_intrigue
	
	is_triggered_only = yes
	
	immediate = {
		death = { death_reason = death_murder_unknown killer = FROM }
	}
	
	desc = EVTDESC_MNM_20035
	
	option = {
		name = EVTOPTA_MNM_20035
	}
}


###########################################
# Infernal Choir - Hidden start
# Only with rivals
# Fired from on_society_bi_yearly_pulse
###########################################

character_event = {
	id = DWSOC.20060
	hide_window = yes
	
	is_triggered_only = yes
	
	only_playable = yes
	only_capable = yes
	prisoner = no
	
	trigger = {
		society_member_of = dw_the_chosen_of_lilith
		NOT = { has_character_modifier = in_seclusion }
		NOT = { trait = in_hiding }
		is_ill = no
		society = {
			any_society_member = {
				is_incapable = no
				prisoner = no
				NOT = { has_character_modifier = in_seclusion }
				NOT = { trait = in_hiding }
				is_ill = no
				NOT = { character = ROOT }
				OR = {
					is_rival = ROOT
					ROOT = { trait = lunatic }
					ROOT = { trait = possessed }
				}
				NOT = {
					reverse_has_opinion_modifier = {
						who = ROOT
						modifier = opinion_nemesis
					}
				}
			}
		}
	}
	
	weight_multiplier = {
		factor = 1
		modifier = {
			factor = 1.25
			OR = {
				trait = lunatic
				trait = possessed
			}
		}
		modifier = {
			factor = 1.25
			trait = cruel
		}
		modifier = {
			factor = 1.25
			trait = impaler
		}
		modifier = {
			factor = 1.25
			trait = deceitful
		}
	}
	
	immediate = {
		society = {
			random_society_member = {
				limit = {
					ai = yes
					is_incapable = no
					prisoner = no
					NOT = { has_character_modifier = in_seclusion }
					NOT = { trait = in_hiding }
					is_ill = no
					NOT = { character = ROOT }
					OR = {
						is_rival = ROOT
						ROOT = { trait = lunatic }
						ROOT = { trait = possessed }
					}
					NOT = {
						reverse_has_opinion_modifier = {
							who = ROOT
							modifier = opinion_nemesis
						}
					}
				}
				save_event_target_as = dw_buddy
				ROOT = { narrative_event = { id = DWSOC.20061 } }
			}
		}
	}
}

# Infernal Choir - Planning
narrative_event = {
	id = DWSOC.20061
	picture = GFX_evt_lunatic
	border = GFX_event_narrative_frame_intrigue
	
	title = EVTTITLE_MNM_20061
	desc = EVTDESC_MNM_20061

	is_triggered_only = yes

	option = {
		name = EVTOPTA_MNM_20061 # Do it!
		ai_chance = {
			factor = 100
		}
		
		set_character_flag = had_infernal_choir
		
		event_target:dw_buddy = { character_event = { id = DWSOC.20062 days = 3 tooltip = EVT_TT_20062 } }
	}
	option = {
		name = EVTOPTB_MNM_20061 # Not a good idea
		ai_chance = {
			factor = 0
		}
	}
}

# Infernal Choir - Invitation (looks like DWSOC.20012 to the rival)
character_event = {
	id = DWSOC.20062
	picture = GFX_evt_shady_meeting
	border = GFX_event_normal_frame_intrigue
	
	desc = {
		text = EVTDESC_MNM_20012
		trigger = {
			NOT = { trait = paranoid }
		}
	}
	
	desc = {
		text = EVTDESC_MNM_20012_PARANOID
		trigger = {
			trait = paranoid
		}
	}

	is_triggered_only = yes

	option = {
		name = EVTOPTA_MNM_20012 # Of course
		trigger = {
			NOT = { trait = paranoid }
		}
		ai_chance = {
			factor = 100
		}
		
		FROM = { narrative_event = { id = DWSOC.20064 days = 3 tooltip = EVT_TT_20013 } }
	}
	option = {
		name = EVTOPTC_MNM_20062 # I knew it!
		trigger = {
			trait = paranoid
		}
		tooltip_info = paranoid
		
		ai_chance = {
			factor = 1000
		}
		
		set_character_flag = dw_double_cross
		FROM = { narrative_event = { id = DWSOC.20064 tooltip = EVT_TT_20064 days = 3 } }
	}
	option = {
		name = EVTOPTB_MNM_20012 # No way!
		trigger = {
			NOT = { trait = paranoid }
		}
		
		ai_chance = {
			factor = 1
			modifier = {
				factor = 20
				trait = temperate
			}
			modifier = {
				factor = 10
				trait = kind
			}
			modifier = {
				factor = 10
				trait = just
			}
		}
		
		detract_society_currency_minor_effect = yes
		reverse_opinion = { who = FROM modifier = opinion_coward years = 5 }
		
		FROM = { character_event = { id = DWSOC.20063 days = 3 } }
	}
}

# Rival declined
character_event = {
	id = DWSOC.20063
	picture = GFX_evt_shady_meeting
	border = GFX_event_normal_frame_intrigue
	desc = EVTDESC_MNM_20063
	title = EVTTITLE_MNM_20061
	
	is_triggered_only = yes
	
	option = {
		name = EVTOPTA_MNM_20063
		detract_society_currency_minor_effect = yes
	}
}

# Rival accepts the invitation
narrative_event = {
	id = DWSOC.20064
	picture = GFX_evt_sacrifice #GFX_evt_witch_burning
	border = GFX_event_narrative_frame_intrigue
	
	title = EVTTITLE_MNM_20061
	
	desc = { 
		text = EVTDESC_MNM_20064
		trigger = { FROM = { is_female = no } }
		sound = boiled_alive_male_01
	}
	desc = { 
		text = EVTDESC_MNM_20064
		trigger = { FROM = { is_female = no } }
		sound = boiled_alive_male_02
	}
	desc = { 
		text = EVTDESC_MNM_20064
		trigger = { FROM = { is_female = yes } }
		sound = boiled_alive_female_01
	}
	desc = { 
		text = EVTDESC_MNM_20064
		trigger = { FROM = { is_female = yes } }
		sound = boiled_alive_female_02
	}
	
	is_triggered_only = yes
	
	immediate = {
		if = {
			limit =  { 
				FROM = { has_character_flag = dw_double_cross }
			}
			FROM = { clr_character_flag = dw_double_cross }
			random_courtier = {
				limit = {
					ai = yes
					prisoner = no
					age = 6
					OR = {
						is_close_relative = ROOT
						is_married = ROOT
						is_consort = ROOT
					}
				}
				save_event_target_as = dw_real_victim
				ROOT = { set_character_flag = dw_double_cross }
			}
			if = {
				limit =  { 
					NOT = { has_character_flag = dw_double_cross }
				}
				random_courtier = {
					limit = {
						ai = yes
						prisoner = no
						age = 6
					}
					save_event_target_as = dw_real_victim
					ROOT = { set_character_flag = dw_double_cross }
				}
			}
		}
		
		if = {
			limit =  {
				NOT = { has_character_flag = dw_double_cross }
			}
			FROM = { narrative_event = { id = DWSOC.20065 } }
		}
		
		if = {
			limit =  {
				NOT = { trait = poet }
			}
			random = {
				chance = 33
				set_character_flag = dw_gain_poet
			}
		}
		
		random_courtier = {
			limit = {
				prisoner = yes
				host = { character = ROOT }
			}
			death = {
				death_reason = death_execution_burning killer = ROOT
			}
		}
		random_courtier = {
			limit = {
				prisoner = yes
				host = { character = ROOT }
			}
			death = {
				death_reason = death_execution_burning killer = ROOT
			}
		}
		random_courtier = {
			limit = {
				prisoner = yes
				host = { character = ROOT }
			}
			death = {
				death_reason = death_execution_burning killer = ROOT
			}
		}
	}
	
	option = {
		name = EVTOPTA_MNM_20064
		
		tooltip = {
			FROM = {
				death = {
					death_reason = death_vanished killer = ROOT
				}
			}
		}
		
		add_society_currency_medium_effect = yes
		
		# Increase Cruelty
		if = {
			limit = {
				trait = cruel
				NOT = { lifestyle_traits = 1 }
			}
			add_trait = impaler
		}
		if = {
			limit = {
				NOT = { trait = kind }
				NOT = { trait = cruel }
			}
			add_trait = cruel
		}
		if = {
			limit = {
				trait = kind
			}
			remove_trait = kind
		}
		
		if = {
			limit =  {
				has_character_flag = dw_double_cross
			}
			event_target:dw_real_victim = { character_event = { id = DWSOC.20066 days = 3 } }
			clr_character_flag = dw_double_cross
		}
		
		if = {
			limit = {
				has_character_flag = dw_gain_poet
			}
			add_trait = poet
		}
		
		clr_character_flag = dw_gain_poet
	}
}

# Rival dies horribly
narrative_event = {
	id = DWSOC.20065
	picture = GFX_evt_sacrifice #GFX_evt_witch_burning
	border = GFX_event_narrative_frame_intrigue
	
	title = EVTTITLE_MNM_20061
	
	desc = { 
		text = EVTDESC_MNM_20065
		trigger = { is_female = no }
		sound = boiled_alive_male_01
	}
	desc = { 
		text = EVTDESC_MNM_20065
		trigger = { is_female = no }
		sound = boiled_alive_male_02
	}
	desc = { 
		text = EVTDESC_MNM_20065
		trigger = { is_female = yes }
		sound = boiled_alive_female_01
	}
	desc = { 
		text = EVTDESC_MNM_20065
		trigger = { is_female = yes }
		sound = boiled_alive_female_02
	}
	
	is_triggered_only = yes
	
	immediate = {
		death = {
			death_reason = death_vanished killer = FROM
		}
	}
	
	option = {
		name = EVTOPTA_MNM_20065
	}
}

# Rival replaced with close relative - Bounce through the real victim
character_event = {
	id = DWSOC.20066
	hide_window = yes
	
	is_triggered_only = yes
	
	immediate = {
		FROMFROM = { narrative_event = { id = DWSOC.20067 } }
		FROM = { character_event = { id = DWSOC.20068 } }
		
		death = {
			death_reason = death_vanished killer = FROM
		}
	}
}

# Rival replaced with close relative!
narrative_event = {
	id = DWSOC.20067
	picture = GFX_evt_sacrifice #GFX_evt_witch_burning
	border = GFX_event_narrative_frame_intrigue
	
	title = EVTTITLE_MNM_20061
	
	show_from_from = yes
	
	desc = { 
		text = EVTDESC_MNM_20067
		trigger = { event_target:dw_real_victim = { is_female = no } }
		sound = boiled_alive_male_01
	}
	desc = { 
		text = EVTDESC_MNM_20067
		trigger = { event_target:dw_real_victim = { is_female = no } }
		sound = boiled_alive_male_02
	}
	desc = { 
		text = EVTDESC_MNM_20067
		trigger = { event_target:dw_real_victim = { is_female = yes } }
		sound = boiled_alive_female_01
	}
	desc = { 
		text = EVTDESC_MNM_20067
		trigger = { event_target:dw_real_victim = { is_female = yes } }
		sound = boiled_alive_female_02
	}
	
	is_triggered_only = yes
	
	option = {
		name = EVTOPTA_MNM_20067
		tooltip = {
			event_target:dw_real_victim = {
				death = {
					death_reason = death_vanished killer = FROMFROM
				}
			}
		}
		add_society_currency_medium_effect = yes
	}
}

# You realize what your rival has done!
character_event = {
	id = DWSOC.20068
	picture = GFX_evt_lunatic
	border = GFX_event_normal_frame_intrigue
	
	title = EVTTITLE_MNM_20061
	desc = EVTDESC_MNM_20068
	
	is_triggered_only = yes
	
	immediate = {
		if = {
			limit = {
				NOT = { trait = lunatic }
			}
			random = {
				chance = 34
				set_character_flag = gain_lunatic
			}
		}
	}
	
	option = {
		name = EVTOPTA_MNM_20068
		opinion = {
			who = FROMFROMFROM
			modifier = opinion_nemesis
			years = 100
		}
		hidden_tooltip = {
			FROMFROMFROM = {
				opinion = {
					who = ROOT
					modifier = opinion_nemesis
					years = 100
				}
			}
		}
		
		if = {
			limit = {
				NOT = { trait = paranoid }
				NOT = { trait = trusting }
			}
			add_trait = paranoid
		}
		if = {
			limit = {
				trait = trusting
			}
			remove_trait = trusting
		}
		
		if = {
			limit = {
				has_character_flag = gain_lunatic
			}
			add_trait = lunatic
		}
		
		clr_character_flag = gain_lunatic
	}
}

####### Hidden: Demon/Witch-hunters SET-UP ########
character_event = {
    id = DWSOC.7854
    hide_window = yes
    is_triggered_only = yes

    trigger = {
	    has_dlc = "Mystics"
    	is_devil_worshiper_trigger = yes
    	OR = {
   			has_character_modifier = known_satanist
   			has_character_flag = was_ratted_out_by_fellow_member
    	}
    }
	
	weight_multiplier = {
		factor = 1
		modifier = {
			factor = 1.5
			society_rank == 3
		}
		modifier = {
			factor = 2
			society_rank == 4
		}
		modifier = {
			factor = 2
			independent = yes
		}
	}
	
    immediate = {
    	#chooses who attacks you...
    	random_list = {
    		10 = {
    			trigger = { NOT = { has_character_flag = DW_was_attacked_by_the_slayer } }
    			set_character_flag = DW_was_attacked_by_the_slayer
    		}
    		10 = {
    			set_character_flag = DW_was_attacked_by_angry_villagers
    			trigger = {
    				OR = {
    					has_character_modifier = cat_familiar
    					has_character_modifier = wolf_familiar
    					has_character_modifier = raven_familiar
    					has_character_modifier = owl_familiar
    				}
    				NOT = { has_character_flag = DW_was_attacked_by_angry_villagers }
    			}
    		}
    		10 = {
    			trigger = { NOT = { has_character_flag = DW_was_attacked_by_demon_hunters } }
    			set_character_flag = DW_was_attacked_by_demon_hunters
    		}
    		10 = {
    			trigger = { NOT = { has_character_flag = DW_was_attacked_by_lone_demon_hunter } }
    			set_character_flag = DW_was_attacked_by_lone_demon_hunter
    		}
    		10 = {
    			trigger = { NOT = { has_character_flag = DW_was_attacked_by_righteous_knights } }
    			set_character_flag = DW_was_attacked_by_righteous_knights
    		}

    		#if attacked a second time...
    		10 = {
    			trigger = { has_character_flag = DW_was_attacked_by_the_slayer }
    			modifier = {
   					factor = 1000
  					has_character_flag = DW_was_attacked_by_the_slayer
   				}
    			set_character_flag = DW_was_attacked_by_the_slayer_again
    			clr_character_flag = DW_was_attacked_by_the_slayer
    		}
    		10 = {
    			trigger = { has_character_flag = DW_was_attacked_by_angry_villagers }
    			modifier = {
   					factor = 1000
  					has_character_flag = DW_was_attacked_by_angry_villagers
   				}
    			set_character_flag = DW_was_attacked_by_angry_villagers_again
    			clr_character_flag = DW_was_attacked_by_angry_villagers
    		}
    		10 = {
    			trigger = { has_character_flag = DW_was_attacked_by_demon_hunters }
    			modifier = {
   					factor = 1000
  					has_character_flag = DW_was_attacked_by_demon_hunters
   				}
    			set_character_flag = DW_was_attacked_by_demon_hunters_again
    			clr_character_flag = DW_was_attacked_by_demon_hunters
    		}
    		10 = {
    			trigger = { has_character_flag = DW_was_attacked_by_lone_demon_hunter }
    			modifier = {
   					factor = 1000
  					has_character_flag = DW_was_attacked_by_lone_demon_hunter
   				}
    			set_character_flag = DW_was_attacked_by_lone_demon_hunter_again
    			clr_character_flag = DW_was_attacked_by_lone_demon_hunter
    		}
    		10 = {
    			trigger = { has_character_flag = DW_was_attacked_by_righteous_knights }
    			modifier = {
   					factor = 1000
  					has_character_flag = DW_was_attacked_by_righteous_knights
   				}
    			set_character_flag = DW_was_attacked_by_righteous_knights_again
    			clr_character_flag = DW_was_attacked_by_righteous_knights
    		}
    	}

    	#Finds someone else to blame...
    	hidden_effect = {
	    	society = {
	    		#first look for someone you like...
  				random_society_member = {
					limit = {
						is_incapable = no
						prisoner = no
						NOT = { character = ROOT }
						OR = {
							is_friend = ROOT
							is_lover = ROOT
						}
					}
					save_event_target_as = other_member_to_blame
					break = yes
				}
				#Then look for someone you rival...
				random_society_member = {
					limit = {
						is_incapable = no
						prisoner = no
						is_rival = ROOT
						NOT = { character = ROOT }
					}
					save_event_target_as = other_member_to_blame
					break = yes
				}
				#Then look for someone of your own dynasty...
				random_society_member = {
					limit = {
						is_incapable = no
						prisoner = no
						OR = {
							dynasty = ROOT
							family_of_root_trigger = yes
						}
						NOT = { character = ROOT }
					}
					save_event_target_as = other_member_to_blame
					break = yes
				}
				#find someone at court...
				random_society_member = {
					limit = {
						is_incapable = no
						prisoner = no
						host = { character = ROOT }
						NOT = { character = ROOT }
					}
					save_event_target_as = other_member_to_blame
					break = yes
				}
				
				# Then look for someone in the same realm
				random_society_member = {
					limit = {
						is_incapable = no
						prisoner = no
						NOT = { character = ROOT }
						same_realm = ROOT
					}
					save_event_target_as = other_member_to_blame
					break = yes
				}
				
				# Then look abroad...
				random_society_member = {
					limit = {
						is_incapable = no
						prisoner = no
						NOT = { character = ROOT }
						is_within_diplo_range = ROOT
					}
					save_event_target_as = other_member_to_blame
				}
			}
		}
    }
    after = {
		character_event = { id = DWSOC.7855 }
    }
}

#Demon/Witch-hunters have tracked you down!
character_event = {
    id = DWSOC.7855
    title = EVTTITLE_MNM_7855
    picture = GFX_evt_catching_heretic
    border = GFX_event_normal_frame_war
    is_triggered_only = yes

    hide_from = yes

    trigger = {
    	has_dlc = "Mystics"
    	is_devil_worshiper_trigger = yes
    	OR = {
   			has_character_modifier = known_satanist
   			has_character_flag = was_ratted_out_by_fellow_member
    	}
    }

    desc = {
    	trigger = { has_character_flag = DW_was_attacked_by_the_slayer } #The Slayer
    	text = EVTDESC_MNM_7855_A
    	picture = GFX_evt_whispers
    }
    desc = { #To set pictures...
    	trigger = {
   			has_character_flag = DW_was_attacked_by_angry_villagers # Angry Villagers
    		has_dlc = "Reapers"
    	}
    	text = EVTDESC_MNM_7855_B
    	picture = GFX_evt_witch_burning
    }
    desc = { #To set pictures (if NOT has Reapers)...
    	trigger = {
   			has_character_flag = DW_was_attacked_by_angry_villagers
    		NOT = { has_dlc = "Reapers" }
    	}
    	text = EVTDESC_MNM_7855_B
    	picture = GFX_evt_catching_heretic
    }
    desc = {
    	trigger = { has_character_flag = DW_was_attacked_by_demon_hunters } #Winchesters
    	text = EVTDESC_MNM_7855_C
    	picture = GFX_evt_catching_heretic
    }
    desc = {
    	trigger = { has_character_flag = DW_was_attacked_by_lone_demon_hunter } #Demon Hunter
    	text = EVTDESC_MNM_7855_D
    	picture = GFX_evt_dark_love
    }
    desc = {
    	trigger = { has_character_flag = DW_was_attacked_by_righteous_knights } #Holy Knights
    	text = EVTDESC_MNM_7855_E
    	picture = GFX_evt_catching_heretic
    }
    desc = {
    	trigger = { has_character_flag = DW_was_attacked_by_the_slayer_again } #The Slayer II
    	text = EVTDESC_MNM_7855_A_again
    	picture = GFX_evt_whispers
    }
    desc = { #To set pictures...
    	trigger = {
   			has_character_flag = DW_was_attacked_by_angry_villagers_again # Angry Villagers II
    		has_dlc = "Reapers"
    	}
    	text = EVTDESC_MNM_7855_B_again
    	picture = GFX_evt_witch_burning
    }
    desc = { #To set pictures (if NOT has Reapers)...
    	trigger = {
   			has_character_flag = DW_was_attacked_by_angry_villagers_again
    		NOT = { has_dlc = "Reapers" }
    	}
    	text = EVTDESC_MNM_7855_B_again
    	picture = GFX_evt_catching_heretic
    }
    desc = {
    	trigger = { has_character_flag = DW_was_attacked_by_demon_hunters_again } #Winchesters II
    	text = EVTDESC_MNM_7855_C_again
    	picture = GFX_evt_dark_prayer
    }
    desc = {
    	trigger = { has_character_flag = DW_was_attacked_by_lone_demon_hunter_again } #Demon Hunter II 
    	text = EVTDESC_MNM_7855_D_again
    	picture = GFX_evt_shadow
    }
    desc = {
    	trigger = { has_character_flag = DW_was_attacked_by_righteous_knights_again } #Holy Knights II
    	text = EVTDESC_MNM_7855_E_again
    	picture = GFX_evt_battle
    }

    option = { #fight them...
        name = {
        	trigger = {
        		OR = {
					has_character_flag = DW_was_attacked_by_the_slayer
					has_character_flag = DW_was_attacked_by_angry_villagers
					has_character_flag = DW_was_attacked_by_demon_hunters
					has_character_flag = DW_was_attacked_by_lone_demon_hunter
					has_character_flag = DW_was_attacked_by_righteous_knights
        		}
        	}
        	text = EVTOPTA_MNM_7855
        }
        name = {
        	trigger = {
        		OR = {
					has_character_flag = DW_was_attacked_by_the_slayer_again
					has_character_flag = DW_was_attacked_by_angry_villagers_again
					has_character_flag = DW_was_attacked_by_demon_hunters_again
					has_character_flag = DW_was_attacked_by_lone_demon_hunter_again
					has_character_flag = DW_was_attacked_by_righteous_knights_again
        		}
        	}
        	text = EVTOPTA_MNM_7855_again
        }
        custom_tooltip = { text = EVTOPTA_MNM_7855_TT }

        random_list = {
    		10 = {
    			#Nothing happens
    			modifier = {
   					factor = 0.9
  					has_injury_trigger = yes
   				}
   				modifier = {
   					factor = 0.9
  					is_maimed_trigger = yes
   				}
   				modifier = {
   					factor = 0.9
   					has_severe_disability_trigger = yes
   				}
   				modifier = {
   					factor = 0.9
   					has_medium_disability_trigger = yes
   				}
   				modifier = {
   					factor = 1.1
   					is_smart_trigger = yes
   				}
   				modifier = {
   					factor = 1.1
   					is_strong_trigger = yes
   				}
   				custom_tooltip = { text = they_escape_TT }
    		}
    		30 = { #You are injured
 				modifier = {
   					factor = 0.9
  					combat_rating = 1
   				}
 				modifier = {
   					factor = 0.9
  					combat_rating = 2
   				}
   				modifier = {
   					factor = 0.9
  					combat_rating = 3
   				}
   				modifier = {
   					factor = 0.9
  					combat_rating = 4
   				}
   				modifier = {
   					factor = 0.9
  					combat_rating = 5
   				}
   				custom_tooltip = {
    				text = you_are_seriously_injured_TT
    				hidden_effect = { add_maimed_trait_effect = yes }
    			}
    		}
    		50 = { #You are slain in personal combat
    			modifier = {
   					factor = 0.9
  					combat_rating = 1
   				}
 				modifier = {
   					factor = 0.9
  					combat_rating = 2
   				}
   				modifier = {
   					factor = 0.9
  					combat_rating = 3
   				}
   				modifier = {
   					factor = 0.9
  					combat_rating = 4
   				}
   				modifier = {
   					factor = 0.9
  					combat_rating = 5
   				}
   				modifier = {
   					factor = 0.9
   					has_lifestyle_martial_trigger = yes
   				}
   				modifier = {
   					factor = 0.9
   					has_education_martial_trigger = yes
   					has_top_tier_education_trait_trigger = yes
   				}
   				modifier = {
   					factor = 1.1
					has_severe_disability_trigger = yes
   				}
   				modifier = {
   					factor = 1.1
	   				is_dumb_trigger = yes
   				}
   				modifier = {
   					factor = 1.1
   					is_weak_trigger = yes
   				}
   				custom_tooltip = {
    				text = you_are_killed_in_personal_combat_TT
    				hidden_effect = { death = { death_reason = death_duel } }
    			}
    		}
    	}
    }

    option = { #attempt to bribe them...
        name = {
        	text = EVTOPTC_MNM_7855_A
        	trigger = { has_character_flag = DW_was_attacked_by_the_slayer }
        }
        name = {
        	text = EVTOPTC_MNM_7855_B
        	trigger = { has_character_flag = DW_was_attacked_by_angry_villagers }
        }
        name = {
        	text = EVTOPTC_MNM_7855_C
        	trigger = { has_character_flag = DW_was_attacked_by_demon_hunters }
        }
        name = {
        	text = EVTOPTC_MNM_7855_D
        	trigger = { has_character_flag = DW_was_attacked_by_lone_demon_hunter }
        }
        name = {
        	text = EVTOPTC_MNM_7855_E
        	trigger = { has_character_flag = DW_was_attacked_by_righteous_knights }
        }
		name = {
        	text = EVTOPTC_MNM_7855_A_again
        	trigger = { has_character_flag = DW_was_attacked_by_the_slayer_again }
        }
        name = {
        	text = EVTOPTC_MNM_7855_B_again
        	trigger = { has_character_flag = DW_was_attacked_by_angry_villagers_again }
        }
        name = {
        	text = EVTOPTC_MNM_7855_C_again
        	trigger = { has_character_flag = DW_was_attacked_by_demon_hunters_again }
        }
        name = {
        	text = EVTOPTC_MNM_7855_D_again
        	trigger = { has_character_flag = DW_was_attacked_by_lone_demon_hunter_again }
        }
        name = {
        	text = EVTOPTC_MNM_7855_E_again
        	trigger = { has_character_flag = DW_was_attacked_by_righteous_knights_again }
        }

        custom_tooltip = {
        	text = EVTOPTC_MNM_7855_TT
        }

        scaled_wealth = {
			value = -1 min = -100
		}

    	random_list = {
    		10 = {
   				modifier = {
   					factor = 0.9
  					has_unattractive_trait_trigger = yes
   				}
   				modifier = {
   					factor = 0.9
   					is_unattractive_trigger = yes
   				}
 				modifier = {
   					factor = 1.1
  					diplomacy = 10
   				}
   				modifier = {
   					factor = 1.1
  					diplomacy = 15
   				}
   				modifier = {
   					factor = 1.1
  					diplomacy = 17
   				}
 				modifier = {
   					factor = 1.1
  					diplomacy = 20
   				}
   				modifier = {
   					factor = 1.1
   					has_top_tier_education_trait_trigger = yes
   					has_education_diplomacy_trigger = yes
   				}
   				modifier = {
   					factor = 1.1
  					has_attractive_trait_trigger = yes
   				}
   				modifier = {
   					factor = 1.1
   					is_attractive_trigger = yes
   				}
    			custom_tooltip = { text = they_accept_your_offer_TT }
    		}
    		20 = { #You are injured
    			custom_tooltip = { text = you_are_seriously_injured_TT }
    			hidden_effect = { add_maimed_trait_effect = yes }
    		}
    		40 = { #You are dragged off and burnt as a witch/warlock
    			trigger = {
    				OR = {
    					has_character_flag = DW_was_attacked_by_angry_villagers
    					has_character_flag = DW_was_attacked_by_demon_hunters
    					has_character_flag = DW_was_attacked_by_righteous_knights
    					has_character_flag = DW_was_attacked_by_angry_villagers_again
    					has_character_flag = DW_was_attacked_by_demon_hunters_again
    					has_character_flag = DW_was_attacked_by_righteous_knights_again
    				}
    			}
    			custom_tooltip = {
    				text = they_drag_you_off_to_burn
    				hidden_effect = { death = { death_reason = death_execution_burning } }
    			}
    		}
    		10 = { #You are dragged off and burnt as a witch/warlock
    			trigger = {
    				OR = {
	    				has_character_flag = DW_was_attacked_by_lone_demon_hunter
	    				has_character_flag = DW_was_attacked_by_lone_demon_hunter_again
	    			}
				}
    			custom_tooltip = {
    				text = they_saw_you_in_half
    				hidden_effect = { death = { death_reason = death_execution_sawing } }
    			}
    		}
    		10 = { #You are dragged off and burnt as a witch/warlock
    			trigger = {
    				OR = {
    					has_character_flag = DW_was_attacked_by_the_slayer
    					has_character_flag = DW_was_attacked_by_the_slayer_again   					
    				}
    			}
    			custom_tooltip = {
    				text = they_impale_you
    				hidden_effect = { death = { death_reason = death_execution_impaling } }
    			}
    		}
    	}
    }

	option = { #do a spell (sacrifice your child)...
        name = EVTOPTB_MNM_7855
        custom_tooltip = { text = EVTOPTB_MNM_7855_TT }

        if = {
        	limit = {
        		OR = {
        			has_character_flag = DW_was_attacked_by_the_slayer
        			has_character_flag = DW_was_attacked_by_lone_demon_hunter
        		}
        	}
        	custom_tooltip = { text = EVTOPTB_MNM_7855_TT_singular }	
        }
        if = {
        	limit = {
        		OR = {
        			has_character_flag = DW_was_attacked_by_angry_villagers
        			has_character_flag = DW_was_attacked_by_demon_hunters
        			has_character_flag = DW_was_attacked_by_righteous_knights
        		}
        	}
        	custom_tooltip = { text = EVTOPTB_MNM_7855_TT_plural }	
        }

        detract_society_currency_major_effect = yes

        random_child = {
        	limit = { is_child_of = ROOT }
        	random_accident_death_effect = yes
        }

        trigger = {
    		has_society_currency_major_trigger = yes
    		num_of_children = 1
    		any_child = {
    			is_child_of = ROOT
    			ai = yes
    		}
        }
    }

    option = { #offer them another member...!
        name = EVTOPTD_MNM_7855
        custom_tooltip = { text = EVTOPTD_MNM_7855_TT }

		if = {
        	limit = {
        		OR = {
					has_character_flag = DW_was_attacked_by_angry_villagers
					has_character_flag = DW_was_attacked_by_demon_hunters
					has_character_flag = DW_was_attacked_by_righteous_knights
					has_character_flag = DW_was_attacked_by_angry_villagers_again
					has_character_flag = DW_was_attacked_by_demon_hunters_again
					has_character_flag = DW_was_attacked_by_righteous_knights_again
				}
        	}
	        random = {
	        	chance = 50
	        	custom_tooltip = {
    				text = they_drag_you_off_to_burn
    				hidden_effect = { death = { death_reason = death_execution_burning } }
    			}
	        }        	
        }
        if = {
        	limit = {
        		OR = {
        			has_character_flag = DW_was_attacked_by_lone_demon_hunter
        			has_character_flag = DW_was_attacked_by_lone_demon_hunter_again
        		}
        	}
	        random = {
	        	chance = 50
	        	custom_tooltip = {
    				text = they_saw_you_in_half
    				hidden_effect = { death = { death_reason = death_execution_sawing } }
    			}
	        }        	
        }
        if = {
        	limit = {
        		OR = {
	        		has_character_flag = DW_was_attacked_by_the_slayer
	        		has_character_flag = DW_was_attacked_by_the_slayer_again
        		}
        	}
	        random = {
	        	chance = 50
	        	custom_tooltip = {
    				text = they_impale_you
    				hidden_effect = { death = { death_reason = death_execution_impaling } }
    			}
	        }        	
        }

        event_target:other_member_to_blame = {
        	set_character_flag = was_ratted_out_by_fellow_member
			if = {
				limit = {
					ai = yes
				}
				increase_visibility_minor_effect = yes
			}
        }

        trigger = {
 			is_devil_worshiper_trigger = yes
 			society_rank < 4

 			event_target:other_member_to_blame = { always = yes }
        }
    }
	
    after = {
    	#CLEAR ALL FLAGS
    	clr_character_flag = DW_was_attacked_by_the_slayer_again
    	clr_character_flag = DW_was_attacked_by_angry_villagers_again
    	clr_character_flag = DW_was_attacked_by_demon_hunters_again
    	clr_character_flag = DW_was_attacked_by_lone_demon_hunter_again
    	clr_character_flag = DW_was_attacked_by_righteous_knights_again
    	clr_character_flag = was_ratted_out_by_fellow_member
    }
}